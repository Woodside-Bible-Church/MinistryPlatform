<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circles of Commitment - The Hub | Granger Community Church</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'granger-green': '#AAD43C',
                        'granger-green-alt': '#90c23e',
                        'granger-black': '#252525',
                        'granger-dark': '#1a1a1a',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
        }

        /* Concentric circles visualization */
        .circles-container {
            position: relative;
            width: 280px;
            height: 280px;
        }

        .circle {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .circle:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(170, 212, 60, 0.3);
        }

        .circle-community {
            width: 280px;
            height: 280px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 3px dashed #AAD43C;
            top: 0;
            left: 0;
        }

        .circle-crowd {
            width: 224px;
            height: 224px;
            background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
            border: 3px solid #AAD43C;
            top: 28px;
            left: 28px;
        }

        .circle-congregation {
            width: 168px;
            height: 168px;
            background: linear-gradient(135deg, #a5d6a7 0%, #81c784 100%);
            border: 3px solid #90c23e;
            top: 56px;
            left: 56px;
        }

        .circle-committed {
            width: 112px;
            height: 112px;
            background: linear-gradient(135deg, #81c784 0%, #66bb6a 100%);
            border: 3px solid #90c23e;
            top: 84px;
            left: 84px;
        }

        .circle-core {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #AAD43C 0%, #90c23e 100%);
            border: 3px solid #252525;
            top: 112px;
            left: 112px;
        }

        .circle-label {
            position: absolute;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 10px;
            color: #252525;
            white-space: nowrap;
        }

        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.15);
        }

        .trend-up {
            color: #AAD43C;
        }

        .trend-down {
            color: #ef4444;
        }

        .sidebar-link {
            transition: all 0.2s ease;
        }

        .sidebar-link:hover {
            background-color: rgba(170, 212, 60, 0.1);
        }

        .sidebar-link.active {
            background-color: rgba(170, 212, 60, 0.2);
            border-left: 3px solid #AAD43C;
        }

        /* Tab Navigation */
        .tab-btn {
            padding: 12px 24px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.05em;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            background: none;
            cursor: pointer;
        }
        .tab-btn:hover { color: #252525; }
        .tab-btn.active {
            color: #252525;
            border-bottom-color: #AAD43C;
        }

        .tab-content {
            display: block;
        }
        .tab-content.hidden {
            display: none;
        }

        /* Clickable table rows */
        .clickable-row {
            cursor: pointer;
        }
        .clickable-row:hover {
            background-color: #f3f4f6;
        }

        /* Collapsible sections for Circle Configuration */
        .config-group-header {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .config-group-header:hover {
            background-color: #f9fafb;
        }

        /* Multiselect Dropdown */
        .multiselect {
            position: relative;
            min-width: 160px;
        }

        .multiselect-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            width: 100%;
            background: white;
            border: 1px solid #d1d5db;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 600;
            color: #252525;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .multiselect-btn:hover {
            border-color: #AAD43C;
        }

        .multiselect-btn:focus {
            outline: none;
            border-color: #AAD43C;
            box-shadow: 0 0 0 2px rgba(170, 212, 60, 0.2);
        }

        .multiselect-btn .chevron {
            transition: transform 0.2s ease;
        }

        .multiselect.open .multiselect-btn .chevron {
            transform: rotate(180deg);
        }

        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            min-width: 200px;
            background: white;
            border: 1px solid #d1d5db;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 50;
            display: none;
            max-height: 280px;
            overflow-y: auto;
        }

        .multiselect.open .multiselect-dropdown {
            display: block;
        }

        .multiselect-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .multiselect-option:hover {
            background-color: #f3f4f6;
        }

        .multiselect-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #AAD43C;
            cursor: pointer;
        }

        .multiselect-option label {
            flex: 1;
            cursor: pointer;
            font-size: 13px;
            color: #374151;
        }

        .multiselect-option.selected {
            background-color: rgba(170, 212, 60, 0.1);
        }

        .multiselect-select-all {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            cursor: pointer;
            transition: background-color 0.15s ease;
            border-bottom: 1px solid #e5e7eb;
            background-color: #f9fafb;
        }

        .multiselect-select-all:hover {
            background-color: #f3f4f6;
        }

        .multiselect-select-all input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #AAD43C;
            cursor: pointer;
        }

        .multiselect-select-all label {
            flex: 1;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .multiselect-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #AAD43C;
            color: #252525;
            font-size: 11px;
            font-weight: 700;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            padding: 0 6px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #9ca3af;
        }

        </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Top Navigation -->
    <nav class="bg-granger-black text-white">
        <div class="max-w-[1600px] mx-auto flex items-center justify-between h-16 px-8">
            <!-- Logo & Title -->
            <div class="flex items-center gap-3">
                <img src="grangerLogo.svg" alt="Granger" class="w-10 h-10 invert">
                <div>
                    <div class="text-sm font-bold uppercase tracking-wider">THE HUB</div>
                    <div class="text-xs text-gray-400 uppercase tracking-wide">Granger Community Church</div>
                </div>
            </div>

            <!-- Search (centered) -->
            <div class="flex-1 max-w-md mx-8">
                <div class="relative">
                    <input type="text" placeholder="Search..." class="w-full bg-neutral-700 text-white px-4 py-2 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-500 placeholder-neutral-400">
                    <i data-lucide="search" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                </div>
            </div>

            <!-- User Menu -->
            <div class="flex items-center gap-4">
                <button class="relative p-2 hover:bg-gray-800 transition">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span class="absolute top-1 right-1 w-2 h-2 bg-granger-green rounded-full"></span>
                </button>
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-granger-green rounded-full flex items-center justify-center">
                        <span class="text-granger-black font-bold text-sm">JD</span>
                    </div>
                    <div class="text-sm">
                        <div class="font-semibold">John Doe</div>
                        <div class="text-xs text-gray-400">Staff</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div>
        <!-- Main Content -->
        <main class="max-w-[1600px] mx-auto p-8">
            <!-- Page Header -->
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-granger-black uppercase tracking-tight">Circles of Commitment</h1>
                        <p class="text-gray-500 mt-1">Track engagement levels across your congregation</p>
                    </div>
                    <button class="bg-granger-black text-white px-4 py-2 font-bold uppercase text-sm tracking-wide hover:bg-neutral-700 transition flex items-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        Sync
                    </button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="flex gap-1 mb-6 border-b border-gray-200">
                <button class="tab-btn active" data-tab="circles-over-time" onclick="switchTab('circles-over-time')">Over Time</button>
                <button class="tab-btn" data-tab="circle-participants" onclick="switchTab('circle-participants')">Current</button>
                <button class="tab-btn" data-tab="circle-milestones" onclick="switchTab('circle-milestones')">Milestones</button>
            </div>

            <!-- Tab 1: Circles Over Time -->
            <div id="tab-circles-over-time" class="tab-content">

            <!-- As Of Filter -->
            <div class="flex items-center justify-end mb-6">
                <div class="flex items-center gap-3">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">As of</span>
                    <select class="bg-white border border-gray-300 text-granger-black px-3 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-granger-green">
                        <option>January 2026</option>
                        <option>December 2025</option>
                        <option>November 2025</option>
                        <option>October 2025</option>
                        <option>September 2025</option>
                        <option>August 2025</option>
                        <option>July 2025</option>
                        <option>June 2025</option>
                        <option>May 2025</option>
                        <option>April 2025</option>
                        <option>March 2025</option>
                        <option>February 2025</option>
                    </select>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-2 gap-6 items-stretch">
                <!-- Circles Visualization -->
                <div class="bg-white p-6 shadow-sm h-full">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold text-granger-black uppercase tracking-tight">Overview</h2>
                        <button class="text-gray-400 hover:text-granger-black transition">
                            <i data-lucide="maximize-2" class="w-4 h-4"></i>
                        </button>
                    </div>

                    <div class="flex items-center gap-8">
                        <!-- Circles -->
                        <div class="circles-container flex-shrink-0">
                            <div class="circle circle-community" data-level="community" >
                                <span class="circle-label" style="top: 6px; left: 50%; transform: translateX(-50%);">Community</span>
                            </div>
                            <div class="circle circle-crowd" data-level="crowd" >
                                <span class="circle-label" style="top: 6px; left: 50%; transform: translateX(-50%);">Crowd</span>
                            </div>
                            <div class="circle circle-congregation" data-level="congregation" >
                                <span class="circle-label" style="top: 6px; left: 50%; transform: translateX(-50%);">Congregation</span>
                            </div>
                            <div class="circle circle-committed" data-level="committed" >
                                <span class="circle-label" style="top: 6px; left: 50%; transform: translateX(-50%);">Committed</span>
                            </div>
                            <div class="circle circle-core" data-level="core" >
                                <span class="circle-label" style="top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 8px;">Core</span>
                            </div>
                        </div>

                        <!-- Legend with counts -->
                        <div class="flex-1">
                            <div class="space-y-1">
                            <div class="flex items-center gap-3 p-2 -mx-2 rounded cursor-pointer hover:bg-gray-50 transition" >
                                <div class="w-8 h-8 rounded-full flex-shrink-0 bg-granger-green flex items-center justify-center">
                                    <i data-lucide="globe" class="w-4 h-4 text-granger-black"></i>
                                </div>
                                <span class="font-semibold text-sm text-granger-black flex-1">Community</span>
                                <span class="text-lg font-bold text-granger-black">6,274</span>
                                <span class="text-xs font-semibold trend-up w-12 text-right">+19.4%</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 -mx-2 rounded cursor-pointer hover:bg-gray-50 transition" >
                                <div class="w-8 h-8 rounded-full flex-shrink-0 bg-granger-green flex items-center justify-center">
                                    <i data-lucide="users" class="w-4 h-4 text-granger-black"></i>
                                </div>
                                <span class="font-semibold text-sm text-granger-black flex-1">Crowd</span>
                                <span class="text-lg font-bold text-granger-black">1,344</span>
                                <span class="text-xs font-semibold trend-up w-12 text-right">+6.9%</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 -mx-2 rounded cursor-pointer hover:bg-gray-50 transition" >
                                <div class="w-8 h-8 rounded-full flex-shrink-0 bg-granger-green flex items-center justify-center">
                                    <i data-lucide="church" class="w-4 h-4 text-granger-black"></i>
                                </div>
                                <span class="font-semibold text-sm text-granger-black flex-1">Congregation</span>
                                <span class="text-lg font-bold text-granger-black">520</span>
                                <span class="text-xs font-semibold trend-down w-12 text-right">-0.6%</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 -mx-2 rounded cursor-pointer hover:bg-gray-50 transition" >
                                <div class="w-8 h-8 rounded-full flex-shrink-0 bg-granger-green flex items-center justify-center">
                                    <i data-lucide="heart-handshake" class="w-4 h-4 text-granger-black"></i>
                                </div>
                                <span class="font-semibold text-sm text-granger-black flex-1">Committed</span>
                                <span class="text-lg font-bold text-granger-black">11,231</span>
                                <span class="text-xs font-semibold trend-up w-12 text-right">+0.2%</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 -mx-2 rounded cursor-pointer hover:bg-gray-50 transition" >
                                <div class="w-8 h-8 rounded-full flex-shrink-0 bg-granger-green flex items-center justify-center">
                                    <i data-lucide="star" class="w-4 h-4 text-granger-black"></i>
                                </div>
                                <span class="font-semibold text-sm text-granger-black flex-1">Core</span>
                                <span class="text-lg font-bold text-granger-black">826</span>
                                <span class="text-xs font-semibold trend-up w-12 text-right">+3.4%</span>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Trends Chart -->
                <div class="bg-white p-6 shadow-sm flex flex-col h-full">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold text-granger-black uppercase tracking-tight">Movement</h2>
                        <div class="flex items-center gap-2">
                            <button class="px-3 py-1 text-xs font-semibold uppercase tracking-wide bg-granger-green text-granger-black">YTD</button>
                            <button class="px-3 py-1 text-xs font-semibold uppercase tracking-wide text-gray-400 hover:bg-gray-100 transition">6M</button>
                            <button class="px-3 py-1 text-xs font-semibold uppercase tracking-wide text-gray-400 hover:bg-gray-100 transition">12M</button>
                        </div>
                    </div>
                    <div class="flex-1 min-h-0">
                        <canvas id="trendsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Bottom Section -->
            <div class="grid grid-cols-2 gap-6 mt-6">
                <!-- New Joins This Month -->
                <div class="bg-white p-6 shadow-sm">
                    <div class="mb-6">
                        <h2 class="text-lg font-bold text-granger-black uppercase tracking-tight">New Joins</h2>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-100">
                                    <th class="text-left py-3 text-xs font-bold text-gray-400 uppercase tracking-wider">Circle</th>
                                    <th class="text-right py-3 text-xs font-bold text-gray-400 uppercase tracking-wider">Count</th>
                                    <th class="text-right py-3 text-xs font-bold text-gray-400 uppercase tracking-wider">Change</th>
                                    <th class="text-right py-3 text-xs font-bold text-gray-400 uppercase tracking-wider">Trend</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-gray-50">
                                    <td class="py-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-2 h-2 rounded-full" style="background-color: #e8f5e9; border: 1px dashed #AAD43C;"></div>
                                            <span class="font-semibold text-granger-black">Community</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-right font-bold text-granger-black">1,020</td>
                                    <td class="py-3 text-right">
                                        <span class="text-sm font-semibold trend-up">+19.4%</span>
                                    </td>
                                    <td class="py-3 text-right">
                                        <i data-lucide="trending-up" class="w-4 h-4 trend-up inline"></i>
                                    </td>
                                </tr>
                                <tr class="border-b border-gray-50">
                                    <td class="py-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-2 h-2 rounded-full" style="background-color: #c8e6c9;"></div>
                                            <span class="font-semibold text-granger-black">Crowd</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-right font-bold text-granger-black">87</td>
                                    <td class="py-3 text-right">
                                        <span class="text-sm font-semibold trend-up">+6.9%</span>
                                    </td>
                                    <td class="py-3 text-right">
                                        <i data-lucide="trending-up" class="w-4 h-4 trend-up inline"></i>
                                    </td>
                                </tr>
                                <tr class="border-b border-gray-50">
                                    <td class="py-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-2 h-2 rounded-full" style="background-color: #a5d6a7;"></div>
                                            <span class="font-semibold text-granger-black">Congregation</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-right font-bold text-granger-black">72</td>
                                    <td class="py-3 text-right">
                                        <span class="text-sm font-semibold trend-up">+15.9%</span>
                                    </td>
                                    <td class="py-3 text-right">
                                        <i data-lucide="trending-up" class="w-4 h-4 trend-up inline"></i>
                                    </td>
                                </tr>
                                <tr class="border-b border-gray-50">
                                    <td class="py-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-2 h-2 rounded-full" style="background-color: #81c784;"></div>
                                            <span class="font-semibold text-granger-black">Committed</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-right font-bold text-granger-black">18</td>
                                    <td class="py-3 text-right">
                                        <span class="text-sm font-semibold trend-up">+0.2%</span>
                                    </td>
                                    <td class="py-3 text-right">
                                        <i data-lucide="trending-up" class="w-4 h-4 trend-up inline"></i>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-2 h-2 rounded-full bg-granger-green"></div>
                                            <span class="font-semibold text-granger-black">Core</span>
                                        </div>
                                    </td>
                                    <td class="py-3 text-right font-bold text-granger-black">27</td>
                                    <td class="py-3 text-right">
                                        <span class="text-sm font-semibold trend-up">+3.4%</span>
                                    </td>
                                    <td class="py-3 text-right">
                                        <i data-lucide="trending-up" class="w-4 h-4 trend-up inline"></i>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    </div>

                <!-- In Chart -->
                <div class="bg-white p-6 shadow-sm flex flex-col">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold text-granger-black uppercase tracking-tight">In</h2>
                    </div>
                    <div class="flex-1 min-h-0">
                        <canvas id="inChart"></canvas>
                    </div>
                </div>
            </div>
            </div><!-- End Tab 1 -->

            <!-- Tab 2: Circle Participants -->
            <div id="tab-circle-participants" class="tab-content hidden">
                <!-- Filter Bar -->
                <div class="bg-white p-4 shadow-sm mb-6">
                    <div class="flex items-center justify-between gap-4">
                        <div class="flex items-center gap-2 flex-wrap flex-1">
                            <!-- Campus Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Campus</span>
                                <div class="multiselect" data-filter="campus">
                                    <button type="button" class="multiselect-btn" onclick="toggleMultiselect(this)">
                                        <span class="multiselect-label">All Campuses</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                                    </button>
                                    <div class="multiselect-dropdown">
                                        <div class="multiselect-select-all">
                                            <input type="checkbox" id="campus-all">
                                            <label for="campus-all">Select All</label>
                                        </div>
                                        <div class="multiselect-option" data-value="1">
                                            <input type="checkbox" id="campus-1">
                                            <label for="campus-1">Granger Campus</label>
                                        </div>
                                        <div class="multiselect-option" data-value="4">
                                            <input type="checkbox" id="campus-4">
                                            <label for="campus-4">Elkhart Campus</label>
                                        </div>
                                        <div class="multiselect-option" data-value="6">
                                            <input type="checkbox" id="campus-6">
                                            <label for="campus-6">All Church</label>
                                        </div>
                                        <div class="multiselect-option" data-value="9">
                                            <input type="checkbox" id="campus-9">
                                            <label for="campus-9">Online</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Participant Type Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Participant Type</span>
                                <div class="multiselect" data-filter="participant-type">
                                    <button type="button" class="multiselect-btn" onclick="toggleMultiselect(this)">
                                        <span class="multiselect-label">All Types</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                                    </button>
                                    <div class="multiselect-dropdown">
                                        <div class="multiselect-select-all">
                                            <input type="checkbox" id="ptype-all">
                                            <label for="ptype-all">Select All</label>
                                        </div>
                                        <div class="multiselect-option" data-value="35">
                                            <input type="checkbox" id="ptype-35">
                                            <label for="ptype-35">Church Family</label>
                                        </div>
                                        <div class="multiselect-option" data-value="29">
                                            <input type="checkbox" id="ptype-29">
                                            <label for="ptype-29">Attendee</label>
                                        </div>
                                        <div class="multiselect-option" data-value="28">
                                            <input type="checkbox" id="ptype-28">
                                            <label for="ptype-28">New</label>
                                        </div>
                                        <div class="multiselect-option" data-value="24">
                                            <input type="checkbox" id="ptype-24">
                                            <label for="ptype-24">MC3 Neighbor</label>
                                        </div>
                                        <div class="multiselect-option" data-value="34">
                                            <input type="checkbox" id="ptype-34">
                                            <label for="ptype-34">Non-Attending/Other</label>
                                        </div>
                                        <div class="multiselect-option" data-value="33">
                                            <input type="checkbox" id="ptype-33">
                                            <label for="ptype-33">Dropped</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Engagement Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Engagement</span>
                                <div class="multiselect" data-filter="engagement">
                                    <button type="button" class="multiselect-btn" onclick="toggleMultiselect(this)">
                                        <span class="multiselect-label">All Engagement</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                                    </button>
                                    <div class="multiselect-dropdown">
                                        <div class="multiselect-select-all">
                                            <input type="checkbox" id="eng-all">
                                            <label for="eng-all">Select All</label>
                                        </div>
                                        <div class="multiselect-option" data-value="2">
                                            <input type="checkbox" id="eng-2">
                                            <label for="eng-2">Fully Engaged</label>
                                        </div>
                                        <div class="multiselect-option" data-value="1">
                                            <input type="checkbox" id="eng-1">
                                            <label for="eng-1">Partially Engaged</label>
                                        </div>
                                        <div class="multiselect-option" data-value="3">
                                            <input type="checkbox" id="eng-3">
                                            <label for="eng-3">Lapsing</label>
                                        </div>
                                        <div class="multiselect-option" data-value="5">
                                            <input type="checkbox" id="eng-5">
                                            <label for="eng-5">Observing</label>
                                        </div>
                                        <div class="multiselect-option" data-value="4">
                                            <input type="checkbox" id="eng-4">
                                            <label for="eng-4">Lapsed</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Household Position Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Household Position</span>
                                <div class="multiselect" data-filter="household-position">
                                    <button type="button" class="multiselect-btn" onclick="toggleMultiselect(this)">
                                        <span class="multiselect-label">All Positions</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                                    </button>
                                    <div class="multiselect-dropdown">
                                        <div class="multiselect-select-all">
                                            <input type="checkbox" id="hpos-all">
                                            <label for="hpos-all">Select All</label>
                                        </div>
                                        <div class="multiselect-option" data-value="1">
                                            <input type="checkbox" id="hpos-1">
                                            <label for="hpos-1">Head of Household</label>
                                        </div>
                                        <div class="multiselect-option" data-value="2">
                                            <input type="checkbox" id="hpos-2">
                                            <label for="hpos-2">Minor Child</label>
                                        </div>
                                        <div class="multiselect-option" data-value="3">
                                            <input type="checkbox" id="hpos-3">
                                            <label for="hpos-3">Other Adult</label>
                                        </div>
                                        <div class="multiselect-option" data-value="4">
                                            <input type="checkbox" id="hpos-4">
                                            <label for="hpos-4">Adult Child</label>
                                        </div>
                                        <div class="multiselect-option" data-value="5">
                                            <input type="checkbox" id="hpos-5">
                                            <label for="hpos-5">Guest Child</label>
                                        </div>
                                        <div class="multiselect-option" data-value="6">
                                            <input type="checkbox" id="hpos-6">
                                            <label for="hpos-6">Company</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Marital Status Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Marital Status</span>
                                <div class="multiselect" data-filter="marital-status">
                                    <button type="button" class="multiselect-btn" onclick="toggleMultiselect(this)">
                                        <span class="multiselect-label">All Statuses</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                                    </button>
                                    <div class="multiselect-dropdown">
                                        <div class="multiselect-select-all">
                                            <input type="checkbox" id="marital-all">
                                            <label for="marital-all">Select All</label>
                                        </div>
                                        <div class="multiselect-option" data-value="2">
                                            <input type="checkbox" id="marital-2">
                                            <label for="marital-2">Married</label>
                                        </div>
                                        <div class="multiselect-option" data-value="1">
                                            <input type="checkbox" id="marital-1">
                                            <label for="marital-1">Single</label>
                                        </div>
                                        <div class="multiselect-option" data-value="3">
                                            <input type="checkbox" id="marital-3">
                                            <label for="marital-3">Divorced</label>
                                        </div>
                                        <div class="multiselect-option" data-value="4">
                                            <input type="checkbox" id="marital-4">
                                            <label for="marital-4">Widowed</label>
                                        </div>
                                        <div class="multiselect-option" data-value="6">
                                            <input type="checkbox" id="marital-6">
                                            <label for="marital-6">Separated</label>
                                        </div>
                                        <div class="multiselect-option" data-value="5">
                                            <input type="checkbox" id="marital-5">
                                            <label for="marital-5">Partnered</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gender Filter -->
                            <div class="filter-group">
                                <span class="filter-label">Gender</span>
                                <div class="multiselect" data-filter="gender">
                                    <button type="button" class="multiselect-btn" onclick="toggleMultiselect(this)">
                                        <span class="multiselect-label">All Genders</span>
                                        <i data-lucide="chevron-down" class="w-4 h-4 chevron"></i>
                                    </button>
                                    <div class="multiselect-dropdown">
                                        <div class="multiselect-select-all">
                                            <input type="checkbox" id="gender-all">
                                            <label for="gender-all">Select All</label>
                                        </div>
                                        <div class="multiselect-option" data-value="1">
                                            <input type="checkbox" id="gender-1">
                                            <label for="gender-1">Male</label>
                                        </div>
                                        <div class="multiselect-option" data-value="2">
                                            <input type="checkbox" id="gender-2">
                                            <label for="gender-2">Female</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="resetAllFilters()" class="px-4 py-2 text-sm font-semibold text-gray-600 hover:text-granger-black hover:bg-gray-100 transition whitespace-nowrap">
                            Reset Filters
                        </button>
                    </div>
                </div>

                <!-- Summary Stats Cards -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-white p-4 shadow-sm">
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Total Participants</div>
                        <div class="text-2xl font-bold text-granger-black">20,195</div>
                        <div class="text-xs text-gray-500 mt-1">Current snapshot</div>
                    </div>
                    <div class="bg-white p-4 shadow-sm">
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Fully Engaged</div>
                        <div class="text-2xl font-bold text-granger-black">5,324</div>
                        <div class="text-xs text-green-600 mt-1">26.4% of total</div>
                    </div>
                    <div class="bg-white p-4 shadow-sm">
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Partially Engaged</div>
                        <div class="text-2xl font-bold text-granger-black">9,007</div>
                        <div class="text-xs text-yellow-600 mt-1">44.6% of total</div>
                    </div>
                    <div class="bg-white p-4 shadow-sm">
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Lapsing</div>
                        <div class="text-2xl font-bold text-granger-black">3,864</div>
                        <div class="text-xs text-orange-600 mt-1">19.1% of total</div>
                    </div>
                    <div class="bg-white p-4 shadow-sm">
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Lapsed</div>
                        <div class="text-2xl font-bold text-granger-black">2,000</div>
                        <div class="text-xs text-red-600 mt-1">9.9% of total</div>
                    </div>
                </div>

                <!-- Charts Row 1 -->
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- Circle Distribution -->
                    <div class="bg-white p-6 shadow-sm">
                        <h3 class="text-lg font-bold text-granger-black uppercase tracking-tight mb-4">Circle Distribution</h3>
                        <div class="h-64">
                            <canvas id="participantsCircleChart"></canvas>
                        </div>
                    </div>

                    <!-- Engagement by Circle -->
                    <div class="bg-white p-6 shadow-sm">
                        <h3 class="text-lg font-bold text-granger-black uppercase tracking-tight mb-4">Engagement by Circle</h3>
                        <div class="h-64">
                            <canvas id="engagementByCircleChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div class="grid grid-cols-3 gap-6 mb-6">
                    <!-- Campus Breakdown -->
                    <div class="bg-white p-6 shadow-sm">
                        <h3 class="text-lg font-bold text-granger-black uppercase tracking-tight mb-4">By Campus</h3>
                        <div class="h-56">
                            <canvas id="campusChart"></canvas>
                        </div>
                    </div>

                    <!-- Gender Breakdown -->
                    <div class="bg-white p-6 shadow-sm">
                        <h3 class="text-lg font-bold text-granger-black uppercase tracking-tight mb-4">By Gender</h3>
                        <div class="h-56">
                            <canvas id="genderChart"></canvas>
                        </div>
                    </div>

                    <!-- Marital Status -->
                    <div class="bg-white p-6 shadow-sm">
                        <h3 class="text-lg font-bold text-granger-black uppercase tracking-tight mb-4">By Marital Status</h3>
                        <div class="h-56">
                            <canvas id="maritalChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 3 -->
                <div class="grid grid-cols-2 gap-6">
                    <!-- Participant Type -->
                    <div class="bg-white p-6 shadow-sm">
                        <h3 class="text-lg font-bold text-granger-black uppercase tracking-tight mb-4">By Participant Type</h3>
                        <div class="h-56">
                            <canvas id="participantTypeChart"></canvas>
                        </div>
                    </div>

                    <!-- Household Position -->
                    <div class="bg-white p-6 shadow-sm">
                        <h3 class="text-lg font-bold text-granger-black uppercase tracking-tight mb-4">By Household Position</h3>
                        <div class="h-56">
                            <canvas id="householdPositionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div><!-- End Tab 2 -->

            <!-- Tab 3: Circle Milestones -->
            <div id="tab-circle-milestones" class="tab-content hidden">
                <!-- Joined Community -->
                <div class="bg-white shadow-sm mb-6">
                    <div class="config-group-header flex items-center justify-between px-6 py-4 cursor-pointer hover:bg-gray-50 transition" onclick="toggleConfigGroup('community')">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full flex items-center justify-center" style="background-color: #e8f5e9; border: 2px dashed #AAD43C;">
                            </div>
                            <h3 class="font-bold text-granger-black uppercase tracking-wide">Joined Community</h3>
                            <span class="text-sm text-gray-400">(2 milestones)</span>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 config-chevron-community transition-transform"></i>
                    </div>
                    <div id="config-group-community">
                        <table class="w-full">
                            <thead>
                                <tr class="border-t border-b border-gray-100">
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top" style="width: 400px;"><div>Milestone</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Total</div><div class="font-normal normal-case tracking-normal text-gray-300">In Circle</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Changed</div><div class="font-normal normal-case tracking-normal text-gray-300">This Month</div></th>
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top"><div>Description</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/1/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Joined Crowd</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">59,758</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 12,453</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Contact has entered the Crowd circle</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/2/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Participant Start Date</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">134,678</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 28,741</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Initial participation date recorded</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Joined Crowd -->
                <div class="bg-white shadow-sm mb-6">
                    <div class="config-group-header flex items-center justify-between px-6 py-4 cursor-pointer hover:bg-gray-50 transition" onclick="toggleConfigGroup('crowd')">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full" style="background-color: #c8e6c9;"></div>
                            <h3 class="font-bold text-granger-black uppercase tracking-wide">Joined Crowd</h3>
                            <span class="text-sm text-gray-400">(5 milestones)</span>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 config-chevron-crowd transition-transform"></i>
                    </div>
                    <div id="config-group-crowd">
                        <table class="w-full">
                            <thead>
                                <tr class="border-t border-b border-gray-100">
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top" style="width: 400px;"><div>Milestone</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Total</div><div class="font-normal normal-case tracking-normal text-gray-300">In Circle</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Changed</div><div class="font-normal normal-case tracking-normal text-gray-300">This Month</div></th>
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top"><div>Description</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/3/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">First Life Group</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">5,767</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 1,842</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">First time joining a life group</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/4/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">First Time Guest</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">2,002</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 687</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">First visit recorded</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/5/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Joined Congregation</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">53,392</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 8,214</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Contact has entered the Congregation circle</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/6/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">New Family Visit</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">363</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 112</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">New family has visited</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/7/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">New-Kids Checkin</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">12,778</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 3,456</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">First kids check-in recorded</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Joined Congregation -->
                <div class="bg-white shadow-sm mb-6">
                    <div class="config-group-header flex items-center justify-between px-6 py-4 cursor-pointer hover:bg-gray-50 transition" onclick="toggleConfigGroup('congregation')">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full" style="background-color: #a5d6a7;"></div>
                            <h3 class="font-bold text-granger-black uppercase tracking-wide">Joined Congregation</h3>
                            <span class="text-sm text-gray-400">(6 milestones)</span>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 config-chevron-congregation transition-transform"></i>
                    </div>
                    <div id="config-group-congregation">
                        <table class="w-full">
                            <thead>
                                <tr class="border-t border-b border-gray-100">
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top" style="width: 400px;"><div>Milestone</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Total</div><div class="font-normal normal-case tracking-normal text-gray-300">In Circle</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Changed</div><div class="font-normal normal-case tracking-normal text-gray-300">This Month</div></th>
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top"><div>Description</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/8/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Baptism</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">8,940</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 2,156</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Baptism recorded</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/9/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">I Am Committed</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">2,707</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 834</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Commitment declaration made</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/10/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">I previously decided to follow Christ</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">2,940</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 612</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Prior faith decision recorded</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/11/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">I recently decided to follow Christ</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">2,882</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 743</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Recent faith decision recorded</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/12/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">New-Giving</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">254</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 89</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">First giving recorded</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/13/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Rededication</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">1,691</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 423</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Rededication of faith</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Joined Committed -->
                <div class="bg-white shadow-sm mb-6">
                    <div class="config-group-header flex items-center justify-between px-6 py-4 cursor-pointer hover:bg-gray-50 transition" onclick="toggleConfigGroup('committed')">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full" style="background-color: #81c784;"></div>
                            <h3 class="font-bold text-granger-black uppercase tracking-wide">Joined Committed</h3>
                            <span class="text-sm text-gray-400">(4 milestones)</span>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 config-chevron-committed transition-transform"></i>
                    </div>
                    <div id="config-group-committed">
                        <table class="w-full">
                            <thead>
                                <tr class="border-t border-b border-gray-100">
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top" style="width: 400px;"><div>Milestone</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Total</div><div class="font-normal normal-case tracking-normal text-gray-300">In Circle</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Changed</div><div class="font-normal normal-case tracking-normal text-gray-300">This Month</div></th>
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top"><div>Description</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/14/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Joined Committed</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">50,044</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 11,231</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Contact has entered the Committed circle</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/15/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Began Serving</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">50,036</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 9,847</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Started serving in a ministry</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/16/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Membership</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">1,115</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 287</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Became a church member</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/17/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">S.H.A.P.E. Covenant</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">344</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 124</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Completed S.H.A.P.E. covenant</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Joined Core -->
                <div class="bg-white shadow-sm mb-6">
                    <div class="config-group-header flex items-center justify-between px-6 py-4 cursor-pointer hover:bg-gray-50 transition" onclick="toggleConfigGroup('core')">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full bg-granger-green"></div>
                            <h3 class="font-bold text-granger-black uppercase tracking-wide">Joined Core</h3>
                            <span class="text-sm text-gray-400">(3 milestones)</span>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 config-chevron-core transition-transform"></i>
                    </div>
                    <div id="config-group-core">
                        <table class="w-full">
                            <thead>
                                <tr class="border-t border-b border-gray-100">
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top" style="width: 400px;"><div>Milestone</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Total</div><div class="font-normal normal-case tracking-normal text-gray-300">In Circle</div></th>
                                    <th class="text-right py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider w-28 align-top"><div>Changed</div><div class="font-normal normal-case tracking-normal text-gray-300">This Month</div></th>
                                    <th class="text-left py-2 px-4 text-xs font-bold text-gray-400 uppercase tracking-wider align-top"><div>Description</div><div class="font-normal normal-case tracking-normal text-gray-300">&nbsp;</div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/18/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Joined Core</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">1,136</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 826</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Contact has entered the Core circle</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/19/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Began Leading</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">866</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 312</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Started in a leadership role</td>
                                </tr>
                                <tr class="clickable-row" onclick="window.open('https://my.grangerchurch.com/mp/343/20/317', '_blank')">
                                    <td class="py-3 px-4 font-semibold text-granger-black">Core 401 Graduate</td>
                                    <td class="py-3 px-4 text-right font-bold text-granger-black">483</td>
                                    <td class="py-3 px-4 text-right text-granger-green font-medium">+ 156</td>
                                    <td class="py-3 px-4 text-sm text-gray-500">Completed Core 401 class</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div><!-- End Tab 3 -->

        </main>
    </div>

    <!-- Circle Detail Modal -->
    <div id="circleModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onclick="if(event.target === this) closeCircleModal()">
        <div class="bg-white max-w-lg w-full shadow-2xl relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeCircleModal()" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition z-10">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <div class="p-8">
                <!-- Modal Header -->
                <div class="mb-8">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Circle Details</div>
                    <h2 id="modalTitle" class="text-3xl font-bold text-granger-black uppercase tracking-tight">Committed</h2>
                    <p id="modalDescription" class="text-gray-500 mt-1">People maturing in their faith through prayer, giving, and training</p>
                </div>

                <!-- Engagement Donut Chart -->
                <div class="flex justify-center">
                    <div style="width: 300px; height: 300px;">
                        <canvas id="engagementChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Circle data for modal
        const circleData = {
            community: {
                title: 'Community',
                description: 'The unchurched in the immediate area - your starting point and hottest prospects',
                total: '6,274',
                engaged: '1,254',
                partial: '2,891',
                lapsing: '2,129',
                milestones: [
                    { icon: 'users', name: 'Joined Crowd', count: '59,758' },
                    { icon: 'calendar', name: 'Participant Start Date', count: '134,678' }
                ],
                campuses: [
                    { name: 'Granger Campus', count: '4,521' },
                    { name: 'Elkhart Campus', count: '982' },
                    { name: 'South Bend', count: '534' },
                    { name: 'Mishawaka', count: '237' }
                ]
            },
            crowd: {
                title: 'Crowd',
                description: 'Everyone who shows up - regular service attendees',
                total: '1,344',
                engaged: '412',
                partial: '623',
                lapsing: '309',
                milestones: [
                    { icon: 'users', name: 'First Life Group', count: '5,767' },
                    { icon: 'user-check', name: 'First Time Guest', count: '2,002' },
                    { icon: 'log-in', name: 'Joined Congregation', count: '53,392' },
                    { icon: 'home', name: 'New Family Visit', count: '363' },
                    { icon: 'baby', name: 'New-Kids Checkin', count: '12,778' }
                ],
                campuses: [
                    { name: 'Granger Campus', count: '923' },
                    { name: 'Elkhart Campus', count: '241' },
                    { name: 'South Bend', count: '112' },
                    { name: 'Mishawaka', count: '68' }
                ]
            },
            congregation: {
                title: 'Congregation',
                description: 'Official members of the church with a sense of ownership',
                total: '520',
                engaged: '187',
                partial: '214',
                lapsing: '119',
                milestones: [
                    { icon: 'droplet', name: 'Baptism', count: '8,940' },
                    { icon: 'heart', name: 'I Am Committed', count: '2,707' },
                    { icon: 'cross', name: 'I previously decided to follow Christ', count: '2,940' },
                    { icon: 'sparkles', name: 'I recently decided to follow Christ', count: '2,882' },
                    { icon: 'gift', name: 'New-Giving', count: '254' },
                    { icon: 'rotate-ccw', name: 'Rededication', count: '1,691' }
                ],
                campuses: [
                    { name: 'Granger Campus', count: '356' },
                    { name: 'Elkhart Campus', count: '98' },
                    { name: 'South Bend', count: '42' },
                    { name: 'Mishawaka', count: '24' }
                ]
            },
            committed: {
                title: 'Committed',
                description: 'People who pray, give, and are dedicated to growing in discipleship',
                total: '11,231',
                engaged: '2,847',
                partial: '5,123',
                lapsing: '3,261',
                milestones: [
                    { icon: 'flag', name: 'Joined Committed', count: '50,044' },
                    { icon: 'hand-helping', name: 'Began Serving', count: '50,036' },
                    { icon: 'id-card', name: 'Membership', count: '1,115' },
                    { icon: 'shapes', name: 'S.H.A.P.E. Covenant', count: '344' }
                ],
                campuses: [
                    { name: 'Granger Campus', count: '8,456' },
                    { name: 'Elkhart Campus', count: '1,892' },
                    { name: 'South Bend', count: '645' },
                    { name: 'Mishawaka', count: '238' }
                ]
            },
            core: {
                title: 'Core',
                description: 'Ministers and leaders - without these people the church would come to a standstill',
                total: '826',
                engaged: '624',
                partial: '156',
                lapsing: '46',
                milestones: [
                    { icon: 'flag', name: 'Joined Core', count: '1,136' },
                    { icon: 'megaphone', name: 'Began Leading', count: '866' },
                    { icon: 'award', name: 'Core 401 Graduate', count: '483' }
                ],
                campuses: [
                    { name: 'Granger Campus', count: '612' },
                    { name: 'Elkhart Campus', count: '134' },
                    { name: 'South Bend', count: '52' },
                    { name: 'Mishawaka', count: '28' }
                ]
            }
        };

        function openCircleModal(circle) {
            const data = circleData[circle];
            if (!data) return;

            document.getElementById('modalTitle').textContent = data.title;
            document.getElementById('modalDescription').textContent = data.description;

            document.getElementById('circleModal').classList.remove('hidden');

            // Parse engagement numbers
            const engagedNum = parseInt(data.engaged.replace(/,/g, ''));
            const partialNum = parseInt(data.partial.replace(/,/g, ''));
            const lapsingNum = parseInt(data.lapsing.replace(/,/g, ''));

            // Store values for closure
            const chartData = {
                engaged: data.engaged,
                partial: data.partial,
                lapsing: data.lapsing,
                engagedNum: engagedNum,
                partialNum: partialNum,
                lapsingNum: lapsingNum
            };

            // Use setTimeout to ensure DOM has painted
            setTimeout(function() {
                try {
                    if (window.engagementChart && typeof window.engagementChart.destroy === 'function') {
                        window.engagementChart.destroy();
                    }
                    window.engagementChart = null;

                    const canvas = document.getElementById('engagementChart');
                    if (!canvas) {
                        console.error('Canvas not found');
                        return;
                    }

                    console.log('Creating chart with data:', chartData);

                    window.engagementChart = new Chart(canvas, {
                        type: 'doughnut',
                        data: {
                            labels: [
                                'Fully Engaged (' + chartData.engaged + ')',
                                'Partially Engaged (' + chartData.partial + ')',
                                'Lapsing (' + chartData.lapsing + ')'
                            ],
                            datasets: [{
                                data: [chartData.engagedNum, chartData.partialNum, chartData.lapsingNum],
                                backgroundColor: ['#AAD43C', '#eab308', '#ef4444'],
                                borderColor: ['#ffffff', '#ffffff', '#ffffff'],
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            cutout: '50%',
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 20,
                                        font: {
                                            family: 'Poppins',
                                            size: 13,
                                            weight: '600'
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log('Chart created successfully');
                } catch (e) {
                    console.error('Chart error:', e);
                }
            }, 150);

            lucide.createIcons();
        }

        function closeCircleModal() {
            document.getElementById('circleModal').classList.add('hidden');
        }

        // Initialize Lucide icons
        lucide.createIcons();

        // Trends Chart
        const ctx = document.getElementById('trendsChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'],
                datasets: [
                    {
                        label: 'Community',
                        data: [7372, 7132, 6814, 6487, 6249, 5991, 5804, 5564, 5460, 5359, 5254],
                        borderColor: '#c8e6c9',
                        backgroundColor: 'rgba(200, 230, 201, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'Crowd',
                        data: [845, 834, 861, 931, 980, 1001, 1016, 1086, 1166, 1230, 1257],
                        borderColor: '#a5d6a7',
                        backgroundColor: 'rgba(165, 214, 167, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'Congregation',
                        data: [362, 335, 326, 351, 357, 413, 410, 400, 417, 451, 523],
                        borderColor: '#81c784',
                        backgroundColor: 'rgba(129, 199, 132, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'Committed',
                        data: [9789, 10067, 10365, 10594, 10777, 10901, 11063, 11236, 11243, 11246, 11249],
                        borderColor: '#66bb6a',
                        backgroundColor: 'rgba(102, 187, 106, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'Core',
                        data: [714, 714, 716, 719, 719, 776, 789, 796, 796, 796, 799],
                        borderColor: '#AAD43C',
                        backgroundColor: 'rgba(170, 212, 60, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                family: 'Poppins',
                                size: 11,
                                weight: '600'
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            font: {
                                family: 'Poppins',
                                size: 11
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                family: 'Poppins',
                                size: 11
                            }
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // In Chart
        const inCtx = document.getElementById('inChart').getContext('2d');
        new Chart(inCtx, {
            type: 'bar',
            data: {
                labels: ['Community', 'Crowd', 'Congregation', 'Committed', 'Core'],
                datasets: [{
                    label: 'People in Circle',
                    data: [6274, 1344, 520, 11231, 826],
                    backgroundColor: [
                        '#c8e6c9',
                        '#a5d6a7',
                        '#81c784',
                        '#66bb6a',
                        '#AAD43C'
                    ],
                    borderColor: [
                        '#c8e6c9',
                        '#a5d6a7',
                        '#81c784',
                        '#66bb6a',
                        '#AAD43C'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            font: {
                                family: 'Poppins',
                                size: 11
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                family: 'Poppins',
                                size: 11
                            }
                        }
                    }
                }
            }
        });

        // Circle hover effects
        document.querySelectorAll('.circle').forEach(circle => {
            circle.addEventListener('mouseenter', function() {
                const level = this.dataset.level;
                // Could show a tooltip or highlight related data
            });
        });

        // Tab Switching
        function switchTab(tabId) {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            // Show selected tab
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            // Mark button as active
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // Initialize participants charts when that tab is selected
            if (tabId === 'circle-participants') {
                initParticipantsCharts();
            }
            // Refresh icons for milestones tab
            if (tabId === 'circle-milestones') {
                lucide.createIcons();
            }
        }

        // Participants Charts - track instances to destroy on re-init
        let participantsCharts = {};

        function initParticipantsCharts() {
            // Destroy existing charts
            Object.values(participantsCharts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            participantsCharts = {};

            const circleColors = ['#c8e6c9', '#a5d6a7', '#81c784', '#66bb6a', '#AAD43C'];
            const engagementColors = ['#AAD43C', '#eab308', '#f97316', '#3b82f6', '#ef4444'];

            // Circle Distribution Chart (Doughnut)
            participantsCharts.circle = new Chart(document.getElementById('participantsCircleChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Community', 'Crowd', 'Congregation', 'Committed', 'Core'],
                    datasets: [{
                        data: [6274, 1344, 520, 11231, 826],
                        backgroundColor: circleColors,
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: { family: 'Poppins', size: 11, weight: '600' }
                            }
                        }
                    }
                }
            });

            // Engagement by Circle (Stacked Bar)
            participantsCharts.engagementByCircle = new Chart(document.getElementById('engagementByCircleChart'), {
                type: 'bar',
                data: {
                    labels: ['Community', 'Crowd', 'Congregation', 'Committed', 'Core'],
                    datasets: [
                        {
                            label: 'Fully Engaged',
                            data: [1254, 412, 187, 2847, 624],
                            backgroundColor: '#AAD43C'
                        },
                        {
                            label: 'Partially Engaged',
                            data: [2891, 623, 214, 5123, 156],
                            backgroundColor: '#eab308'
                        },
                        {
                            label: 'Lapsing',
                            data: [1200, 200, 80, 2100, 35],
                            backgroundColor: '#f97316'
                        },
                        {
                            label: 'Observing',
                            data: [500, 80, 25, 800, 8],
                            backgroundColor: '#3b82f6'
                        },
                        {
                            label: 'Lapsed',
                            data: [429, 29, 14, 361, 3],
                            backgroundColor: '#ef4444'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true, grid: { display: false } },
                        y: { stacked: true, grid: { color: 'rgba(0,0,0,0.05)' } }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: { family: 'Poppins', size: 10, weight: '600' }
                            }
                        }
                    }
                }
            });

            // Campus Chart (Horizontal Bar)
            participantsCharts.campus = new Chart(document.getElementById('campusChart'), {
                type: 'bar',
                data: {
                    labels: ['Granger Campus', 'Elkhart Campus', 'Online', 'All Church'],
                    datasets: [{
                        data: [14868, 3365, 1512, 450],
                        backgroundColor: ['#AAD43C', '#81c784', '#a5d6a7', '#c8e6c9'],
                        borderWidth: 0
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: 'rgba(0,0,0,0.05)' } },
                        y: { grid: { display: false } }
                    }
                }
            });

            // Gender Chart (Doughnut)
            participantsCharts.gender = new Chart(document.getElementById('genderChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Female', 'Male'],
                    datasets: [{
                        data: [10704, 9491],
                        backgroundColor: ['#AAD43C', '#66bb6a'],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: { family: 'Poppins', size: 11, weight: '600' }
                            }
                        }
                    }
                }
            });

            // Marital Status Chart (Doughnut)
            participantsCharts.marital = new Chart(document.getElementById('maritalChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Married', 'Single', 'Divorced', 'Widowed', 'Separated', 'Partnered'],
                    datasets: [{
                        data: [9291, 7267, 1817, 1009, 605, 206],
                        backgroundColor: ['#AAD43C', '#66bb6a', '#81c784', '#a5d6a7', '#c8e6c9', '#e8f5e9'],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 10,
                                font: { family: 'Poppins', size: 10, weight: '600' }
                            }
                        }
                    }
                }
            });

            // Participant Type Chart (Horizontal Bar)
            participantsCharts.participantType = new Chart(document.getElementById('participantTypeChart'), {
                type: 'bar',
                data: {
                    labels: ['Church Family', 'Attendee', 'New', 'MC3 Neighbor', 'Non-Attending/Other', 'Dropped'],
                    datasets: [{
                        data: [12542, 4231, 1823, 876, 512, 211],
                        backgroundColor: ['#AAD43C', '#66bb6a', '#81c784', '#a5d6a7', '#c8e6c9', '#e8f5e9'],
                        borderWidth: 0
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: 'rgba(0,0,0,0.05)' } },
                        y: { grid: { display: false } }
                    }
                }
            });

            // Household Position Chart (Horizontal Bar)
            participantsCharts.householdPosition = new Chart(document.getElementById('householdPositionChart'), {
                type: 'bar',
                data: {
                    labels: ['Head of Household', 'Minor Child', 'Other Adult', 'Adult Child', 'Guest Child', 'Company'],
                    datasets: [{
                        data: [8934, 5621, 3212, 1876, 423, 129],
                        backgroundColor: ['#AAD43C', '#66bb6a', '#81c784', '#a5d6a7', '#c8e6c9', '#e8f5e9'],
                        borderWidth: 0
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: 'rgba(0,0,0,0.05)' } },
                        y: { grid: { display: false } }
                    }
                }
            });
        }

        // Circle Configuration - Toggle Groups
        function toggleConfigGroup(group) {
            const content = document.getElementById('config-group-' + group);
            const chevron = document.querySelector('.config-chevron-' + group);

            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                chevron.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('hidden');
                chevron.style.transform = 'rotate(-90deg)';
            }
        }

        // Multiselect Dropdown Functions
        function toggleMultiselect(btn) {
            const multiselect = btn.closest('.multiselect');
            const wasOpen = multiselect.classList.contains('open');

            // Close all other multiselects
            document.querySelectorAll('.multiselect.open').forEach(ms => {
                ms.classList.remove('open');
            });

            // Toggle this one
            if (!wasOpen) {
                multiselect.classList.add('open');
            }
        }

        // Close multiselect when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.multiselect')) {
                document.querySelectorAll('.multiselect.open').forEach(ms => {
                    ms.classList.remove('open');
                });
            }
        });

        // Handle checkbox changes in multiselects
        document.querySelectorAll('.multiselect-option').forEach(option => {
            option.addEventListener('click', function(e) {
                if (e.target.tagName !== 'INPUT') {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                }

                const multiselect = this.closest('.multiselect');
                updateMultiselectLabel(multiselect);
                updateSelectAllState(multiselect);
                this.classList.toggle('selected', this.querySelector('input').checked);
            });
        });

        // Handle Select All checkbox
        document.querySelectorAll('.multiselect-select-all').forEach(selectAll => {
            selectAll.addEventListener('click', function(e) {
                if (e.target.tagName !== 'INPUT') {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                }

                const multiselect = this.closest('.multiselect');
                const isChecked = this.querySelector('input').checked;

                // Toggle all option checkboxes
                multiselect.querySelectorAll('.multiselect-option input[type="checkbox"]').forEach(cb => {
                    cb.checked = isChecked;
                    cb.closest('.multiselect-option').classList.toggle('selected', isChecked);
                });

                updateMultiselectLabel(multiselect);
            });
        });

        function updateSelectAllState(multiselect) {
            const options = multiselect.querySelectorAll('.multiselect-option input[type="checkbox"]');
            const checkedOptions = multiselect.querySelectorAll('.multiselect-option input[type="checkbox"]:checked');
            const selectAllCheckbox = multiselect.querySelector('.multiselect-select-all input[type="checkbox"]');

            // If nothing is selected, auto-select all
            if (checkedOptions.length === 0) {
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = true;
                }
                options.forEach(cb => {
                    cb.checked = true;
                    cb.closest('.multiselect-option').classList.add('selected');
                });
                updateMultiselectLabel(multiselect);
            } else if (selectAllCheckbox) {
                selectAllCheckbox.checked = options.length === checkedOptions.length;
            }
        }

        function updateMultiselectLabel(multiselect) {
            const filterType = multiselect.dataset.filter;
            const optionCheckboxes = multiselect.querySelectorAll('.multiselect-option input[type="checkbox"]');
            const checkedOptionCheckboxes = multiselect.querySelectorAll('.multiselect-option input[type="checkbox"]:checked');
            const labelEl = multiselect.querySelector('.multiselect-label');

            const defaultLabels = {
                'campus': 'All Campuses',
                'participant-type': 'All Types',
                'engagement': 'All Engagement',
                'household-position': 'All Positions',
                'marital-status': 'All Statuses',
                'gender': 'All Genders'
            };

            // If none selected OR all selected, show "All X"
            if (checkedOptionCheckboxes.length === 0 || checkedOptionCheckboxes.length === optionCheckboxes.length) {
                labelEl.innerHTML = defaultLabels[filterType] || 'All';
            } else if (checkedOptionCheckboxes.length === 1) {
                const selectedLabel = checkedOptionCheckboxes[0].closest('.multiselect-option').querySelector('label').textContent;
                labelEl.innerHTML = selectedLabel;
            } else {
                const singularLabels = {
                    'campus': 'Campuses',
                    'participant-type': 'Types',
                    'engagement': 'Levels',
                    'household-position': 'Positions',
                    'marital-status': 'Statuses',
                    'gender': 'Genders'
                };
                labelEl.innerHTML = `<span class="multiselect-badge">${checkedOptionCheckboxes.length}</span> ${singularLabels[filterType] || 'Selected'}`;
            }
        }

        function resetAllFilters() {
            document.querySelectorAll('.multiselect').forEach(multiselect => {
                // Select all checkboxes (default state)
                multiselect.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = true;
                });
                multiselect.querySelectorAll('.multiselect-option').forEach(opt => {
                    opt.classList.add('selected');
                });
                updateMultiselectLabel(multiselect);
            });
        }
    </script>
</body>
</html>
