<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Event Finder Widget</title>
    <link rel="stylesheet" href="Assets/widget.css" />
    <link rel="icon" href="Assets/favicon.png" type="image/png" />
    <link
      rel="stylesheet"
      href="//use.fontawesome.com/releases/v5.0.7/css/all.css"
    />
  </head>
  <body style="margin: auto; max-width: 1200px; margin-top: 2em; padding: 1em">
    <h1>Event Finder</h1>

    <p>
      This widget allows users to search for events by various parameters. It
      displays a list of matching events with details and a link to the event
      page in a nested JSON format. Check out the Live JSON Output (or the
      console log) to see the object and refer to the github to see examples of
      how other widgets have been used in this manner (eg.
      <a
        href="https://github.com/Woodside-Bible-Church/MinistryPlatform/tree/main/CustomWidgets/GroupFinder"
        target="_blank"
        >Group Finder</a
      >) The following parameters can be used to filter events (all are
      optional):
    </p>
    <ul>
      <li>@CongregationID - One congregation can be selected at a time</li>
      <li>
        @MinistryIDs - A comma separated list of ministry ID's can be passed
      </li>
      <li>
        @Search - Search term to filter events by various fields in the event
      </li>
      <li>
        @EventIDs - Comma-separated list of specific event IDs to filter to
      </li>
      <li>@Page - Page number for pagination</li>
      <li>@NumPerPage - Number of events per page</li>
      <li>@Username - Automatically passed by the Login Widget</li>
    </ul>

    <div id="EventFinder"></div>
    <h2 style="margin-top: 2em">Live JSON Output</h2>
    <div id="loader" class="hidden">Loading...</div>
    <pre
      id="jsonOutput"
      style="
        background: #f0f0f0;
        padding: 1em;
        border-radius: 6px;
        overflow-x: auto;
        max-height: 500px;
        font-family: monospace;
      "
    ></pre>

    <script src="Assets/CustomWidgets.js"></script>
    <script src="Assets/Widget.Init.js"></script>

    <script>
      window.addEventListener("widgetLoaded", function (event) {
        const jsonContainer = document.getElementById("jsonOutput");
        if (!jsonContainer) return;

        try {
          const jsonData = event.detail;
          jsonContainer.textContent = JSON.stringify(jsonData, null, 2);
        } catch (err) {
          console.error("Failed to display JSON output:", err);
        }
      });
    </script>
  </body>
</html>
