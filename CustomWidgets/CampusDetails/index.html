<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Campus Details Widget</title>
    <link rel="stylesheet" href="Assets/widget.css" />
    <link rel="icon" href="Assets/favicon.png" />
    <link rel="stylesheet" href="../Announcements/Assets/widget.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="/CustomWidgets/Assets/CustomWidgets.js"></script>
    <script>
      (function initAnnouncementsProgress() {
        function onReady(fn) {
          if (document.readyState !== "loading") fn();
          else document.addEventListener("DOMContentLoaded", fn);
        }

        onReady(() => {
          const root = document.getElementById("AnnouncementsWidget");
          if (!root) return;

          let inited = false;

          const tryInit = () => {
            const scroller = root.querySelector(".ann-scroller");
            const bar = root.querySelector(".ann-progress__bar");
            if (!scroller || !bar) return false; // not rendered yet
            if (inited) return true;

            function update() {
              const max = scroller.scrollWidth - scroller.clientWidth;
              if (max <= 0) {
                bar.style.transform = "scaleX(1)";
                return;
              }
              const pct = scroller.scrollLeft / max;
              const minVisible = 0.15; // small head-start so itâ€™s not empty
              bar.style.transform = `scaleX(${Math.max(pct, minVisible)})`;
            }

            scroller.addEventListener("scroll", update, { passive: true });
            window.addEventListener("resize", update);
            new ResizeObserver(update).observe(scroller);

            // images loading can change widths
            root.querySelectorAll("img").forEach((img) => {
              img.addEventListener("load", update);
            });

            update();
            inited = true;
            return true;
          };

          // Try immediately; if not ready, watch for injected content
          if (!tryInit()) {
            const mo = new MutationObserver(() => {
              if (tryInit()) mo.disconnect();
            });
            mo.observe(root, { childList: true, subtree: true });
          }
        });
      })();
    </script>
  </head>
  <body style="padding: 0; margin: 0">
    <div
      id="CampusDetailsWidget"
      data-component="CustomWidget"
      data-sp="api_Custom_CampusDetailsWidget_JSON"
      data-params="@CongregationID=15"
      data-template="CustomWidgets/CampusDetails/Template/widget.html"
      data-requireUser="false"
      data-cache="false"
      data-host="woodsidebible"
      data-debug="true"
    ></div>
    <div
      id="AnnouncementsWidget"
      class="carousel"
      data-component="CustomWidget"
      data-sp="api_custom_AnnouncementsWidget_JSON"
      data-params="@CongregationID=15"
      data-template="CustomWidgets/Announcements/Template/widget.html"
      data-requireuser="false"
      data-cache="false"
      data-host="woodsidebible"
      data-debug="true"
    ></div>
  </body>
</html>
