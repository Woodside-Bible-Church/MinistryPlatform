{% assign hideDaysOfWeek = false %} {% assign dayFilter = Filters | where:
"Filter", "@DaysOfWeek" | first %} {% if dayFilter and dayFilter.Selected %} {%
assign selectedDaysArray = dayFilter.Selected | split: ", " | sort %} {% assign
allDaysArray = "Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday" |
split: "," | sort %} {% assign selectedDaysJoined = selectedDaysArray | join:
"," %} {% assign allDaysJoined = allDaysArray | join: "," %} {% if
selectedDaysJoined == allDaysJoined %} {% assign hideDaysOfWeek = true %} {%
endif %} {% endif %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="//use.fontawesome.com/releases/v5.0.7/css/all.css"
    />
    <script
      data-search-pseudo-elements
      defer
      src="//use.fontawesome.com/releases/v5.0.7/js/all.js"
    ></script>
  </head>
  <body>
    <section id="groupFinder" class="groupFinderContainer">
      <div class="filterContainer">
        <div class="left">
          <ul class="selectedFilters carousel fadeToBlue">
            {% for filter in Filters %} {% assign isDaysOfWeek = filter.Filter
            == "@DaysOfWeek" %} {% assign skipFilter = isDaysOfWeek and
            hideDaysOfWeek %} {% unless skipFilter %} {% if filter.Options %} {%
            for option in filter.Options %} {% if option.Selected and
            option.Text != blank %}
            <li>
              <a
                class="filterBtn"
                data-filter="{{ filter.Filter }}"
                data-id="{{ option.ID | default: option.Text }}"
                data-action="remove"
              >
                <i class="fa-solid {{ option.Icon }}"></i>
                <span
                  >{% if filter.Use_Prefix == true %}{{ filter.Label }}: {%
                  endif %}{{ option.Text }}</span
                >
                <span class="blur"><i class="fas fa-trash"></i></span>
              </a>
            </li>
            {% endif %} {% endfor %} {% elsif filter.Type == "Checkbox" %} {% if
            filter.Selected == true or filter.Selected == 1 or filter.Selected
            == "1" %}
            <li>
              <a
                class="filterBtn"
                data-filter="{{ filter.Filter }}"
                data-id="1"
                data-action="remove"
              >
                <i
                  class="fa-solid {{ filter.Icon | default: 'fa-square-check' }}"
                ></i>
                <span>{{ filter.Label }}</span>
                <span class="blur"><i class="fas fa-trash"></i></span>
              </a>
            </li>
            {% endif %} {% endif %} {% endunless %} {% endfor %}
          </ul>
        </div>
        <button popovertarget="filterMenu" class="right filterIconContainer">
          <i class="fas fa-filter"></i>
          <span class="filterLabel">Filter</span>
        </button>
      </div>

      {% assign anyFiltersSelected = false %} {% for filter in Filters %} {% if
      filter.Options %} {% for option in filter.Options %} {% if option.Selected
      and option.Text != blank %} {% assign anyFiltersSelected = true %} {%
      endif %} {% endfor %} {% elsif filter.Selected %} {% assign
      anyFiltersSelected = true %} {% endif %} {% endfor %}

      <div popover id="filterMenu" class="filterPopover" popover="manual">
        <button
          class="popoverClose"
          popovertarget="filterMenu"
          popovertargetaction="hide"
          aria-label="Close filters"
          title="Close"
        >
          <i class="fas fa-times"></i>
        </button>

        <form id="filtersForm" class="filterFields" novalidate>
          {% for filter in Filters %} {% if filter.Type %}
          <div
            class="filterGroup"
            data-filter="{{ filter.Filter }}"
            data-type="{{ filter.Type }}"
          >
            <h6>{{ filter.Label }}</h6>

            {% if filter.Type == "Text" %}
            <input
              type="text"
              class="filterSearch"
              name="{{ filter.Filter }}"
              placeholder="Type to search..."
              value="{{ filter.Selected }}"
            />

            {% elsif filter.Type == "Dropdown" %}
            <select class="filterSelect" name="{{ filter.Filter }}">
              <option value="">{{ filter.Placeholder }}</option>
              {% for option in filter.Options %}
              <option
                value="{{ option.ID }}"
                {%
                if
                option.Selected
                %}selected{%
                endif
                %}
              >
                {{ option.Text }}
              </option>
              {% endfor %}
            </select>

            {% elsif filter.Type == "MultiSelect" %}
            <div class="search-select" data-filter="{{ filter.Filter }}">
              <input
                type="text"
                class="search-input"
                placeholder="Search for a {{ filter.Label | downcase }}"
                autocomplete="off"
              />
              <ul class="search-options hidden">
                {% for option in filter.Options %}
                <li
                  class="search-option"
                  data-id="{{ option.ID }}"
                  data-text="{{ option.Text }}"
                >
                  {{ option.Text }}
                </li>
                {% endfor %}
              </ul>

              <input
                type="hidden"
                name="{{ filter.Filter }}"
                class="filterMultiValue"
                value="{{ filter.Selected }}"
              />
            </div>

            {% elsif filter.Type == "Checkbox" %} {% assign cbId = filter.Filter
            | remove: "@" | append: "-cb" %}
            <label for="{{ cbId }}" class="filterCheckboxLabel"
              >{{ filter.Label }}</label
            >
            <input type="checkbox" id="{{ cbId }}" name="{{ filter.Filter }}"
            value="1" class="filterCheckbox" {% if filter.Selected == true or
            filter.Selected == 1 or filter.Selected == "1" %}checked{% endif %}
            /> {% endif %}
          </div>
          {% endif %} {% endfor %}
          <div class="filterActions">
            <button
              type="button"
              class="btn secondaryBtn clearFilters"
              data-action="clear-filters"
            >
              <i class="fas fa-undo"></i> Clear Filters
            </button>
            <button type="submit" class="btn applyFilters">
              <i class="fas fa-check"></i> Apply Filters
            </button>
          </div>
        </form>
      </div>

      {% if Groups.size == 0 %}
      <div class="noResultsFound">
        <span>No groups found</span>
        <a class="btn" href="{{ Settings.GroupInquiryFormBaseURL }}">
          {{ Settings.joinAGroupFormRedirectButton }}
        </a>
      </div>
      {% endif %}

      <div class="groups">
        {% for group in Groups %}
        <div class="groupGrid{% if group.Paused %} groupPaused{% endif %}">
          <h4 class="groupTitle">
            {% if group.User_Is_Leader %}<i class="fas fa-star leaderBadge"></i
            >{% endif %} {{ group.Title }}
          </h4>

          <div class="groupDetailsContainer">
            <h6>{{ Settings.Time_And_Location_Details_Heading }}</h6>
            <div class="groupDetails">
              <div class="iconContainer"><i class="fas fa-calendar"></i></div>
              <div>{{ group.Meeting_Details.Occurrence }}</div>
              <div class="iconContainer"><i class="fas fa-clock"></i></div>
              <div>{{ group.Meeting_Details.Time }}</div>
              <div class="iconContainer">
                <i class="fas fa-map-marker-alt"></i>
              </div>
              <div class="cammelCase">
                {{ group.Meeting_Details.City | capitalize }}
              </div>
            </div>
          </div>

          <div class="groupLeadersContainer">
            <h6>{{ Settings.Leaders_List_Heading }}</h6>
            <div>{{ group.Leaders | join: ", " }}</div>
          </div>

          <div class="groupAboutContainer">
            <h6>{{ Settings.Description_Heading }}</h6>
            <div>{{ group.Description }}</div>
          </div>

          <div class="groupTagsContainer">
            <ul class="groupTags carousel">
              {% if group.Full %}
              <li>
                <a
                  class="filterBtn tag specialTag groupFull"
                  aria-disabled="true"
                >
                  <i class="fas fa-ban"></i><span>Group Full</span>
                </a>
              </li>
              {% endif %} {% if group.Paused %}
              <li>
                <a
                  class="filterBtn tag specialTag groupPaused"
                  aria-disabled="true"
                >
                  <i class="fas fa-pause"></i><span>Group Paused</span>
                </a>
              </li>
              {% endif %} {% for tag in group.Tags %} {% assign matchingFilter =
              Filters | where: "Filter", tag.Filter | first %} {% assign
              isSelected = false %} {% if matchingFilter and
              matchingFilter.Options %} {% for option in matchingFilter.Options
              %} {% if option.ID == tag.ID or option.Text == tag.Text %} {% if
              option.Selected %}{% assign isSelected = true %}{% endif %} {%
              endif %} {% endfor %} {% elsif matchingFilter and
              matchingFilter.Selected %} {% if matchingFilter.Selected == tag.ID
              or matchingFilter.Selected == tag.Text %} {% assign isSelected =
              true %} {% endif %} {% endif %} {% assign icon = tag.Icon |
              default: matchingFilter.Icon | default: 'fa-tag' %}
              <li>
                <a
                  class="filterBtn tag"
                  data-filter="{{ tag.Filter }}"
                  data-id="{{ tag.ID }}"
                  data-action="{% if isSelected %}remove{% else %}add{% endif %}"
                >
                  <i class="fas {{ icon }}"></i>
                  <span>{{ tag.Text }}</span>
                  <span class="blur">
                    <i
                      class="fas fa-{% if isSelected %}trash{% else %}plus{% endif %}"
                    ></i>
                  </span>
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>

          <div class="groupSignUpBtn">
            {% if group.User_In_Group %}
            <a class="btn" href="{{ Settings.ViewGroupBaseURL }}{{ group.ID }}"
              >{{ Settings.View_Group_Button_Label }}</a
            >
            {% elsif group.Paused != true and group.Full != true %}
            <a
              class="btn"
              href="{{ Settings.GroupDetailsBaseURL }}{{ group.ID }}"
              >{{ Settings.Register_Button_Label }}</a
            >
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <p id="copyMessage" class="copy-message">🔗 Link copied to clipboard!</p>

    <script>
      // existing typeahead helpers...
      document.addEventListener("DOMContentLoaded", function () {
        const dropdowns = document.querySelectorAll(".multiSelectDropdown");
        dropdowns.forEach((dropdown) => {
          const input = dropdown.querySelector(".multiSelectInput");
          const list = dropdown.querySelector(".multiSelectOptions");
          if (!input || !list) return;
          input.addEventListener("focus", () => {
            list.style.display = "block";
          });
          input.addEventListener("blur", () => {
            setTimeout(() => {
              list.style.display = "none";
            }, 150);
          });
          input.addEventListener("input", () => {
            const q = input.value.toLowerCase();
            list.querySelectorAll("li").forEach((li) => {
              const t = li.textContent.toLowerCase();
              li.style.display = t.includes(q) ? "block" : "none";
            });
          });
        });
      });
    </script>
  </body>
</html>
