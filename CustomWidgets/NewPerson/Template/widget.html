<div class="date-picker-container">
  <label for="datePicker">Choose a Date:</label>
  <input type="date" id="datePicker" />
</div>

<div class="event-picker-container">
  <label for="eventPicker">Choose an Event:</label>
  <select id="eventPicker">
    <option value="">All Events</option>
    {% assign seenEventIDs = "" | split: "," %}
    {% for person in DataSet1 %}
      {% unless seenEventIDs contains person.Event_ID %}
        <option value="{{ person.Event_ID }}">
          {{ person.Event_Title }} â€” {{ person.Event_Start_Date | date: "%-I:%M%p" }}
        </option>
        {% assign seenEventIDs = seenEventIDs | push: person.Event_ID %}
      {% endunless %}
    {% endfor %}
  </select>
</div>


{% assign currentEventID = "" %}

{% if DataSet1.size > 0 %}
  {% for person in DataSet1 %}
    {% if person.Event_ID != currentEventID %}
      {% assign currentEventID = person.Event_ID %}

      {% if forloop.index != 1 %}
        </div> <!-- Close previous .new-person-cards -->
      {% endif %}

      <h2>{{ person.Event_Title }}</h2>
      <h3>{{ person.Event_Start_Date | date: "%A, %B %e, %Y - %I:%M%p" }}</h3>
      <div class="new-person-cards">
    {% endif %}

    <div class="person-card">
      <span class="badge">{{ person.New_Type }}</span>
      <h3>{{ person.Display_Name }}</h3>

      <div>
        <h4>Group</h4>
        {{ person.Group_Name }}
        <p>Start: {{ person.Group_Start | date: "%-m/%-d/%Y" }}</p>
      </div>

      {% if person.Last_Event %}
      <div>
        <h4>Last Event</h4>
        <p>{{ person.Last_Event }}</p>
      </div>
      {% endif %}

      {% if person.Last_Congregation_Event %}
      <div>
        <h4>Last Location Event</h4>
        <p>{{ person.Last_Congregation_Event }}</p>
      </div>
      {% endif %}

      {% if person.Head_1 or person.Head_2 %}
      <div class="household">
        <h4>Heads of Household</h4>
        <ul>
          {% if person.Head_1 %}
          <li class="household-contact">
            <p>{{ person.Head_1 }}</p>
            <div class="icons">
              {% if person.Head_1_Email %}
              <a href="mailto:{{ person.Head_1_Email }}"><i class="fas fa-envelope"></i></a>
              {% endif %}
              {% if person.Head_1_Mobile %}
              <a href="tel:{{ person.Head_1_Mobile }}"><i class="fas fa-phone"></i></a>
              {% endif %}
            </div>
          </li>
          {% endif %}

          {% if person.Head_2 %}
          <li class="household-contact">
            <p>{{ person.Head_2 }}</p>
            <div class="icons">
              {% if person.Head_2_Email %}
              <a href="mailto:{{ person.Head_2_Email }}"><i class="fas fa-envelope"></i></a>
              {% endif %}
              {% if person.Head_2_Mobile %}
              <a href="tel:{{ person.Head_2_Mobile }}"><i class="fas fa-phone"></i></a>
              {% endif %}
            </div>
          </li>
          {% endif %}
        </ul>
      </div>
      {% endif %}
    </div>
  {% endfor %}

  </div> <!-- Close final .new-person-cards -->
{% else %}
  <div class="empty-state">
    <h3>ðŸ”’ Data not found or user not authorized.</h3>
    <p>
      Please ensure you're logged in with the correct role and parameters are set
      correctly.
    </p>
  </div>
{% endif %}
