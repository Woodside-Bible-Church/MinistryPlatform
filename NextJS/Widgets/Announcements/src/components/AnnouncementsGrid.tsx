'use client';

import React, { useRef, useEffect, useState, useCallback } from 'react';
import { AnnouncementsData, AnnouncementsLabels } from '@/lib/types';
import { AnnouncementCard } from './AnnouncementCard';
import { QuickLinks } from './QuickLinks';

interface AnnouncementsGridProps {
  data: AnnouncementsData;
  mode?: 'grid' | 'carousel' | 'social';
  labels?: AnnouncementsLabels;
}

// Check if URL is a bible.com link
function isBibleComLink(url: string): boolean {
  try {
    const urlObj = new URL(url);
    return urlObj.hostname === 'bible.com' || urlObj.hostname === 'www.bible.com';
  } catch {
    return false;
  }
}

// Convert bible.com URLs to youversion:// deep links where applicable
function getBibleAppDeepLink(url: string): string {
  try {
    const urlObj = new URL(url);

    // Check for event URLs: bible.com/events/123456
    const eventMatch = urlObj.pathname.match(/^\/events\/(\d+)/);
    if (eventMatch) {
      return `youversion://events?id=${eventMatch[1]}`;
    }

    // For other bible.com URLs (passages, etc.), return the original URL
    // as it works as a universal link
    return url;
  } catch {
    return url;
  }
}

// Modal for opening links in different browsers (mobile only)
function LinkOptionsModal({
  url,
  onClose
}: {
  url: string;
  onClose: () => void;
}) {
  const [copied, setCopied] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [dragY, setDragY] = useState(0);
  const [isDragging, setIsDragging] = useState(false);
  const [isClosing, setIsClosing] = useState(false);
  const dragStartY = useRef(0);
  const modalRef = useRef<HTMLDivElement>(null);
  const isBibleLink = isBibleComLink(url);

  // Detect system dark mode preference
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    setIsDarkMode(mediaQuery.matches);

    const handler = (e: MediaQueryListEvent) => setIsDarkMode(e.matches);
    mediaQuery.addEventListener('change', handler);
    return () => mediaQuery.removeEventListener('change', handler);
  }, []);

  // Handle touch start
  const handleTouchStart = (e: React.TouchEvent) => {
    dragStartY.current = e.touches[0].clientY;
    setIsDragging(true);
  };

  // Handle touch move
  const handleTouchMove = (e: React.TouchEvent) => {
    if (!isDragging) return;
    const currentY = e.touches[0].clientY;
    const diff = currentY - dragStartY.current;
    // Only allow dragging down (positive values)
    if (diff > 0) {
      setDragY(diff);
    }
  };

  // Handle touch end
  const handleTouchEnd = () => {
    setIsDragging(false);
    // If dragged more than 100px, dismiss
    if (dragY > 100) {
      handleDismiss();
    } else {
      // Snap back
      setDragY(0);
    }
  };

  // Dismiss with animation
  const handleDismiss = () => {
    setIsClosing(true);
    setTimeout(() => {
      onClose();
    }, 300);
  };

  // Handle overlay click
  const handleOverlayClick = () => {
    handleDismiss();
  };

  const handleCopyLink = async () => {
    try {
      await navigator.clipboard.writeText(url);
      setCopied(true);
      setTimeout(() => {
        setCopied(false);
        onClose();
      }, 1500);
    } catch {
      // Fallback for older browsers
      const textArea = document.createElement('textarea');
      textArea.value = url;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      setCopied(true);
      setTimeout(() => {
        setCopied(false);
        onClose();
      }, 1500);
    }
  };

  const handleOpenInChrome = () => {
    // Convert https:// to googlechromes:// for Chrome on iOS
    const chromeUrl = url.replace(/^https:\/\//, 'googlechromes://').replace(/^http:\/\//, 'googlechrome://');
    const appStoreUrl = 'https://apps.apple.com/app/google-chrome/id535886823';

    window.location.href = chromeUrl;

    // If still on page after 1.5s, app isn't installed - redirect to App Store
    setTimeout(() => {
      if (document.visibilityState === 'visible') {
        window.location.href = appStoreUrl;
      }
    }, 1500);

    onClose();
  };

  const handleOpenInFirefox = () => {
    // Firefox iOS URL scheme
    const firefoxUrl = `firefox://open-url?url=${encodeURIComponent(url)}`;
    const appStoreUrl = 'https://apps.apple.com/app/firefox-private-safe-browser/id989804926';

    window.location.href = firefoxUrl;

    // If still on page after 1.5s, app isn't installed - redirect to App Store
    setTimeout(() => {
      if (document.visibilityState === 'visible') {
        window.location.href = appStoreUrl;
      }
    }, 1500);

    onClose();
  };

  const handleOpenInInstagram = () => {
    // Just navigate in the current context (Instagram's browser)
    window.top?.location.assign(url);
    onClose();
  };

  const handleOpenInBibleApp = () => {
    // Convert to youversion:// deep link for events, use universal link for passages
    const deepLink = getBibleAppDeepLink(url);
    window.location.href = deepLink;
    onClose();
  };

  return (
    <div
      className={`fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm ${isClosing ? 'animate-[fadeOut_0.3s_ease-out_forwards]' : 'animate-[fadeIn_0.2s_ease-out]'} ${isDarkMode ? 'dark' : ''}`}
      onClick={handleOverlayClick}
    >
      <div
        ref={modalRef}
        className={`w-full max-w-lg bg-white dark:bg-neutral-900 rounded-t-2xl p-4 pb-8 ${isClosing ? 'animate-[slideDown_0.3s_ease-out_forwards]' : 'animate-[slideUp_0.3s_ease-out]'}`}
        style={{
          transform: isDragging ? `translateY(${dragY}px)` : undefined,
          transition: isDragging ? 'none' : 'transform 0.2s ease-out'
        }}
        onClick={(e) => e.stopPropagation()}
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
        onTouchEnd={handleTouchEnd}
      >
        {/* Drag handle - visual indicator for swipe */}
        <div className="w-10 h-1 bg-gray-300 dark:bg-neutral-600 rounded-full mx-auto mb-4 cursor-grab active:cursor-grabbing" />

        {/* URL Preview */}
        <div className="text-center mb-4 pb-4 border-b border-gray-200 dark:border-neutral-700">
          <p className="text-xs text-gray-500 dark:text-neutral-400 truncate px-4">{url}</p>
        </div>

        {/* Options */}
        <div className="flex flex-col gap-2">
          {/* Bible App option - shown first for bible.com links */}
          {isBibleLink && (
            <button
              onClick={handleOpenInBibleApp}
              className="flex items-center gap-3 w-full p-4 rounded-xl bg-gray-200 dark:bg-neutral-700 hover:bg-gray-300 dark:hover:bg-neutral-600 shadow-md transition-colors"
            >
              <div className="w-10 h-10 rounded-lg overflow-hidden shadow-sm">
                <img
                  src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2ODEuNTUgNjgxLjYzIj48cGF0aCBkPSJNMTc4LjU5LDEuMTRjMTA5LjA4LTMuMzIsMjE4LjYxLDEuOSwzMjcuNzUtLjM0LDUzLjgzLDEuNyw5OC43Myw5LjEsMTM1Ljk3LDUxLjAzLDMyLjI1LDM2LjMsMzUuNjIsNzEuODIsMzcuNSwxMTguNSw0LjQ3LDExMS4yMy0xLjMyLDIyMy41OSwxLjA0LDMzNS4wNi0xLjY4LDU0Ljc5LTkuMDQsMTAwLjI3LTUyLjAzLDEzNy45Ny0zNS4yNywzMC45Mi03MC40NSwzNC41Ny0xMTUuNTYsMzYuNDQtMTEyLjIyLDQuNjYtMjI1LjU3LTEuMzYtMzM4LjAxLDEuMDktNTQuMzUtMS42Ni05OC4zMy04LjgyLTEzNS45Ny01MS4wM0M3LjI3LDU5My45NSwzLjY4LDU1OC42NiwxLjc4LDUxMi4zNWMtNC41Ny0xMTEuODgsMS40LTIyNC45My0xLjAzLTMzNy4wNSwxLjI5LTQ2LjIyLDYuNzYtODcuOTMsMzguNTMtMTIzLjQ3Qzc4LjUxLDcuOTQsMTIyLjQyLDIuODQsMTc4LjU5LDEuMTRaTTMxMi41OCwxMzAuMTRjLTU2Ljg4LDUuMzEtNTguNjYsMTA0Ljg4LS4xNiwxMDkuNTcsNjguNzYsNS41MSw3MC43NS0xMTYuMTYuMTYtMTA5LjU3Wk0xOTcuNzksMTMxLjg0aC00MWwuMTQsNi44NiwxMC4yMiwyLjA1Yy45MS42NCwxLjM3LDMuNDksMS41Miw0LjY5LDIuMjIsMTguODIsMS40MSw1Ni40MS4xNyw3NS45NC0uMTEsMS43OS0uMyw2LjU4LTEuNjgsNy41NWwtMTAuMjIsMi4wNS0uMTQsNi44Nmg0MWwtLjA1LTYuOTVjLTIuODktLjMxLTEwLjk1LS43Mi0xMC45NS00LjU1di0zOC41aDQydjM4LjVjMCw2LjEyLTE4LjUzLjAzLTEwLjUsMTEuNWgzOS41di04cy0xMC4wOC0xLjY2LTEwLjA4LTEuNjZsLS40Ny04NS4zOCwxLjU0LTIuNDYsOC45LTEuNi4xMS02LjloLTQxdjdjMy45NC0uMjIsMTIsLjI1LDEyLDUuNXYzNi41aC00MnYtMzcuNWMwLTQuMTQsOC4wMS0zLjYzLDEwLjg5LTQuNmwuMTEtNi45Wk00MTYuNzksMTMxLjg0aC00MWwuMTQsNi44NiwxMC4yNiwyLjAzYy45LjY0LDEuNTQsNi4wNiwxLjY0LDcuNTcsMS40MSwxOS45LDEuNzksNTUuNDMtLjA1LDc1LjAyLS4xNywxLjgxLS40OSw0LjE0LTEuNjIsNS42LTMuODQsMi42OS0xNS4yMy0xLjk0LTguODYsOC45MWg3Ny41Yy4zLTguMjgtMS4yMy0xNi4yNC0xLjA1LTI0LjU1LjA3LTIuOTIsMi41Ny05LjI4LS42LTEwLjMxbC02LjM2LS4xNWMtLjk2LDExLjM0LTEuMzgsMjUuNS0xNS41LDI3LjAxLTMuMzIuMzUtMjEuNTcuNDQtMjMuNTEtLjUtLjg0LS40MS0xLjUzLTEuMzEtMS43OS0yLjIxbC0uMTctODMuNzdjLjk2LTQuOTYsNy4xLTMuMTUsMTAuODYtNC42M2wuMTEtNi45Wk00ODQuNzksMTMxLjg0aC0zN2wuMDUsNy45NmM0LjY0LS41NSw1LjY3LDIuNDUsNy43Niw1Ljc0LDEwLjU4LDE2LjY5LDE4Ljc3LDM2Ljg5LDI4Ljk3LDU0LjAzLS4yNCw0Ljg3LDEuOTQsMjcuOTgtMS45OCwyOS42MS01LjE0LDIuMTUtMTQuMDMtMS41OC04LjI5LDguNjZoMzkuNWwtLjA1LTYuOTVjLTMuMDMtLjYxLTkuNzItLjI4LTEwLjc1LTMuNzUtLjc2LTIuNTYtLjY4LTMwLjUzLjAxLTMzLjU5LDEwLjA2LTEzLjQ0LDE2Ljc4LTQwLjgxLDI3Ljg5LTUyLjExLDMuNS0zLjU2LDYuMzgtMS4yNCw0LjktOS42aC0zMXY3LjAxYzMuODItLjIyLDExLjItLjE1LDEyLDQuNTQsMS42NSw5LjY2LTE2LjU1LDMzLjg1LTE5LjAxLDQ0LjQ2bC0yMi45Ni00Mi41Ni45Ni00Ljk2LDkuMDEtMS40OXYtNi45OVpNMTk5LjgsMzIzLjg1YzE2LjEyLTUuMzMsMjEuNjItMjcuNjQsOS40OC00MC0xMS4yMy0xMS40NC0zNi4wNC03LjUzLTUxLjAzLTcuOTctMy4xMi0uMDktMTQuMTgtMi43NS0xNi4wMi0uMTF2Ni4xM2MyLjE2LDMuMDcsMTAuNTMtMy40OSwxMS42LDkuMzksMi4wMSwyNC4yNy0xLjQ5LDUxLjM2LS4xNCw3NS45NC0xLjI1LDkuNTYtOS41Niw0Ljg2LTExLjQ3LDcuNTNsLjUsNi42NCw1Mi40Ni0uNjhjMjYuMDUtMy4wNCwzOC42My0zMy43MiwxNy4xLTUwLjg5bC0xMi40OS01Ljk5Wk0yNzQuOCwyNzUuODRsLTQwLjA3LS41Ni0uOTQsNy41N2MxMC4xMy0uODMsMTEuMzEuOTksMTIuMDQsMTAuNDYsMS40NCwxOC41MiwxLjY0LDUyLjY2LS4wNSw3MS4wMi0uMTYsMS43NS0uOTEsNy4wOS0xLjk3LDguMDNsLTEwLjAyLDEuNDguMTUsNi4zNywxLjUsMS41LDM4LjQyLS4zLjk0LTcuNTdjLTMuNDksMC0xMC4xOS45My0xMS4wMS0zLjQ5bC0uMDUtODMuMDUsMS4wMy0yLjk3LDEwLjAzLTEuNDh2LTcuMDFaTTM0My44LDMyMy44NmMyMC45NC05LjEzLDIxLjQyLTM4LjU4LTEuNDYtNDYuMDctMTEuNDctMy43NS0yNy43NC0xLjU0LTQwLjA5LTEuOTEtNS4xNi0uMTUtMTAuOTMtMS45NS0xNi40Ni0xLjA1djguMDFzMTAuNTQsMS45NiwxMC41NCwxLjk2bC41MiwyLjQ4Yy0yLjM1LDI1LjgyLDMsNTYuNzktLjE2LDgxLjk5LS4xNiwxLjI2LS4zOCwyLjkzLTEuNjUsMy41N2wtOS4yNi45OXY4LjAxYzE2Ljk2LTIuODYsMzUuNTEuNjMsNTIuMzgtMS4xMywyNS4zNC0yLjY0LDM4Ljc1LTMwLjY3LDE5LjY1LTQ5LjRsLTE0LjAxLTcuNDZaTTQxNy43OSwyNzUuODRoLTM5LjVjLTIuMTEsMS41Ni0xLjY5LDQuNTMtMS4zOSw2Ljg5bDEwLjI1LDIuMDFjMS4wMS43LDEuNDksNC4yNCwxLjYyLDUuNiwxLjc2LDE4Ljc0LDEuNzcsNTcuMjguMDYsNzYuMDQtLjk5LDEwLjg0LTkuNTgsNS41MS0xMS42MSw4LjM4bC0uNDMsNi4wN2g3OWMuMjQtMTEuNDItMi40OS0yMi42MywwLTM0aC04Yy0uMzksNy4yNC0xLjU5LDIxLjA4LTguNzIsMjQuNzctNS40NSwyLjgyLTE4LjUxLDIuNy0yNC44MiwyLjI3LTYuMDItLjQxLTYuOTctLjE3LTcuNS02LjUtMi4xMS0yNS4yMywxLjYtNTMuNDMuMTEtNzguOTdsMS45NS00LjA1LDguOTMtMS41Ni4wNS02Ljk1Wk01NDAuNzksMjc1Ljg0aC03NnY2Ljk5YzUuOTUuNTcsMTAuMzctLjM5LDExLjA2LDYuNDUsMi41MiwyNS4wNi0xLjkyLDU0LjQ2LS4xNiw3OS45OWwtMS42NSwzLjU3LTkuMjYuOTl2Ny4wMWg3OS4wMWMuNTgtMS40LTEtMy0xLTMuNXYtMjkuNWwtNy41Ny45M2MtMS4xMiwxMi45Ny0xLjY4LDIzLjUyLTE2Ljk1LDI1LjA1LTQuMDEuNC0xNi40LjY4LTE5Ljk2LS4wMi0yLjUzLS40OS00LjUzLTQuMy00LjUzLTYuNDd2LTM1LjVjMTUuMTYtMi4wNywxOS41MSw0LjczLDE4Ljk5LDE5LjAxLDEuOTktLjYzLDguMjMsMS41OCw4LjAyLTEuNWwtMS4wMS00My41MS02Ljg2LjE0Yy0xLjg4LDEzLjMtMy4yMiwyMS4xOS0xOS4xNCwxOC44NnYtMzYuNWMwLS42MiwxLjM2LTIuNDksMS41MS0zLjQ5LjQ0LS44MSwxLjE3LS44NywxLjk3LTEuMDMsMy42NC0uNzIsMjMuOS0uMywyNy4wOS45NCw4LjE0LDMuMTksNi4xOSwxNC4xMyw4LjU3LDIwLjk0bDYuODYuMTR2LTI2LjVjMC0uNSwxLjU4LTIuMSwxLTMuNVpNNjQ3Ljc4LDQ2Mi44NGMtMjUuNTMsMzcuNDMtNjcuNzYsNTIuMTgtMTExLjUsNTUuOTktMTQ2Ljc3LDMuMTYtMjk0LjAyLTEuMzMtNDQwLjcxLDIuMjktNTguMTUsOS4zOS01MS42OSw2Ni4xLTE0LjI1LDk3LjY5LDE1LjQzLDEzLjAyLDM4LjA3LDIyLjI3LDU4LjA5LDI0LjkxLDEyMi40MS0xLjQ3LDI0OC44MSw2LjI4LDM3MC44NC4wOCw5Mi45Ni00LjcyLDEzMC4xNy00NC4yNiwxMzYuNTMtMTM2LjQ3bDEtNDQuNDlaIiBmaWxsPSIjQTM1MjRBIi8+PHBhdGggZD0iTTY0Ny43OCw0NjIuODRsLTEsNDQuNDljLTYuMzYsOTIuMjEtNDMuNTcsMTMxLjc1LTEzNi41MywxMzYuNDctMTIyLjAyLDYuMi0yNDguNDMtMS41NS0zNzAuODQtLjA4LTIwLjAyLTIuNjQtNDIuNjYtMTEuODktNTguMDktMjQuOTEtMzcuNDQtMzEuNTktNDMuOTEtODguMywxNC4yNS05Ny42OSwxNDYuNy0zLjYxLDI5My45NS44OCw0NDAuNzEtMi4yOSw0My43My0zLjgxLDg1Ljk3LTE4LjU2LDExMS41LTU1Ljk5Wk0yMzEuNzksNTM2Ljg0aC0xMDZ2NzlsNTMuNS0yNi42Myw1Mi41LDI1LjYzdi03OFoiIGZpbGw9IiNGREY4RjAiLz48cGF0aCBkPSJNMTk3Ljc5LDEzMS44NGwtLjExLDYuOWMtMi44OC45OC0xMC44OS40Ny0xMC44OSw0LjZ2MzcuNWg0MnYtMzYuNWMwLTUuMjUtOC4wNi01LjcyLTEyLjAxLTUuNXYtN2g0MS4wMWwtLjExLDYuOS04LjksMS42LTEuNTQsMi40Ni40Nyw4NS4zOCwxMC4wOCwxLjY2djhoLTM5LjUxYy04LjAzLTExLjQ3LDEwLjUtNS4zOCwxMC41LTExLjV2LTM4LjVoLTQydjM4LjVjMCwzLjgzLDguMDYsNC4yNCwxMC45NSw0LjU1bC4wNSw2Ljk1aC00MWwuMTQtNi44NiwxMC4yMi0yLjA1YzEuMzktLjk3LDEuNTctNS43NiwxLjY4LTcuNTUsMS4yNC0xOS41MywyLjA1LTU3LjEzLS4xNy03NS45NC0uMTQtMS4yLS42MS00LjA1LTEuNTItNC42OWwtMTAuMjItMi4wNS0uMTQtNi44Nmg0MVoiIGZpbGw9IiNGREY4RjAiLz48cGF0aCBkPSJNMzQzLjgsMzIzLjg2bDE0LjAxLDcuNDZjMTkuMTEsMTguNzMsNS43LDQ2Ljc2LTE5LjY1LDQ5LjQtMTYuODcsMS43Ni0zNS40Mi0xLjczLTUyLjM4LDEuMTN2LTguMDFzOS4yNS0uOTksOS4yNS0uOTljMS4yNi0uNjQsMS40OS0yLjMxLDEuNjUtMy41NywzLjE2LTI1LjItMi4yLTU2LjE3LjE2LTgxLjk5bC0uNTItMi40OC0xMC41NC0xLjk2di04LjAxYzUuNTQtLjkxLDExLjMxLjg5LDE2LjQ2LDEuMDUsMTIuMzYuMzcsMjguNjItMS44NSw0MC4wOSwxLjkxLDIyLjg3LDcuNDgsMjIuNCwzNi45MywxLjQ2LDQ2LjA3Wk0zMTQuNzksMzIyLjg0YzkuMjMuMDIsMTguNSwxLjQsMjMuNTUtNy45NSwzLjYzLTYuNzEsNC4xOS0yMy44NS0yLjE5LTI4LjkxLTQuODgtMy44Ny0yMS4zNi02LjAyLTIxLjM2LDIuMzZ2MzQuNVpNMzE0Ljc5LDMyOS44NHYzNy41YzAsMTEsMjIuMDgsNS43NCwyNy41NC41NCw2LjU3LTYuMjUsNy42NC0yMi43MiwyLjkxLTI5Ljk5LTEuNjgtMi41OC05LjE2LTguMDUtMTEuOTUtOC4wNWgtMTguNVoiIGZpbGw9IiNGREY4RjAiLz48cGF0aCBkPSJNMTk5LjgsMzIzLjg1bDEyLjQ5LDUuOTljMjEuNTMsMTcuMTcsOC45NCw0Ny44NS0xNy4xLDUwLjg5bC01Mi40Ni42OC0uNS02LjY0YzEuOTEtMi42NywxMC4yMSwyLjAzLDExLjQ3LTcuNTMtMS4zNi0yNC41OCwyLjE0LTUxLjY3LjE0LTc1Ljk0LTEuMDctMTIuODktOS40NC02LjMzLTExLjYtOS4zOXYtNi4xM2MxLjg0LTIuNjUsMTIuOS4wMiwxNi4wMi4xMSwxNC45OS40NCwzOS44LTMuNDcsNTEuMDMsNy45NywxMi4xNCwxMi4zNiw2LjY0LDM0LjY3LTkuNDgsNDBaTTE3MS43OSwzMjIuODRjMTYuMDQsMS42OSwyNS44Ny0zLjMzLDI2LjA4LTIwLjQ5cy04LjQ3LTIxLjktMjQuMDgtMTkuMDFjLS40NS4yNy0yLDIuNzItMiwzdjM2LjVaTTE3MS43OSwzMjkuODR2NDAuNWMwLDQuNzksMTUuMTcsMi44MSwxOC4wNiwyLjA2LDE0LjUzLTMuOCwxOC40LTIxLjA5LDEyLjQ2LTMzLjU3LTEuOTEtNC04Ljc3LTguOTktMTMuMDEtOC45OWgtMTcuNVoiIGZpbGw9IiNGREY4RjAiLz48cGF0aCBkPSJNMzEyLjU4LDEzMC4xNGM3MC41OS02LjU5LDY4LjYsMTE1LjA5LS4xNiwxMDkuNTctNTguNS00LjY5LTU2LjcyLTEwNC4yNi4xNi0xMDkuNTdaTTMxNC41NywxMzcuMDdjLTMzLjAxLDMuNDYtMzUuMzIsODEuMDYtNi4xMyw5My42Miw0MS40NiwxNy44NCw1MS4xNi03Ny41MSwxNi43Mi05MS43Mi0zLjY4LTEuNTItNi41OC0yLjMyLTEwLjU5LTEuOVoiIGZpbGw9IiNGREY4RjAiLz48cGF0aCBkPSJNNTQwLjc5LDI3NS44NGMuNTgsMS40LTEsMy0xLDMuNXYyNi41bC02Ljg2LS4xNGMtMi4zOC02LjgtLjQzLTE3Ljc1LTguNTctMjAuOTQtMy4xOS0xLjI1LTIzLjQ1LTEuNjYtMjcuMDktLjk0LS44LjE2LTEuNTMuMjItMS45NywxLjAzLS4xNSwxLTEuNTEsMi44OC0xLjUxLDMuNDl2MzYuNWMxNS45MiwyLjMyLDE3LjI2LTUuNTYsMTkuMTQtMTguODZsNi44Ni0uMTQsMS4wMSw0My41MWMuMjEsMy4wOC02LjAzLjg3LTguMDIsMS41LjUyLTE0LjI4LTMuODMtMjEuMDgtMTguOTktMTkuMDF2MzUuNWMwLDIuMTcsMS45OSw1Ljk4LDQuNTMsNi40NywzLjU2LjY5LDE1Ljk1LjQyLDE5Ljk2LjAyLDE1LjI3LTEuNTQsMTUuODMtMTIuMDgsMTYuOTUtMjUuMDVsNy41Ny0uOTN2MjkuNWMwLC41LDEuNTgsMi4xLDEsMy41aC03OXYtNy4wMXM5LjI2LS45OSw5LjI2LS45OWwxLjY1LTMuNTdjLTEuNzYtMjUuNTMsMi42OC01NC45My4xNi03OS45OS0uNjktNi44NC01LjExLTUuODgtMTEuMDUtNi40NXYtNi45OXM3NS45OSwwLDc1Ljk5LDBaIiBmaWxsPSIjRkRGOEYwIi8+PHBhdGggZD0iTTQ4NC43OSwxMzEuODR2Ni45OXMtOS4wMiwxLjQ5LTkuMDIsMS40OWwtLjk2LDQuOTYsMjIuOTYsNDIuNTZjMi40Ni0xMC42MSwyMC42Ni0zNC44LDE5LjAxLTQ0LjQ2LS44LTQuNjktOC4xOC00Ljc2LTEyLTQuNTR2LTcuMDFoMzEuMDFjMS40Nyw4LjM2LTEuNCw2LjA0LTQuOSw5LjYtMTEuMTEsMTEuMy0xNy44MiwzOC42Ny0yNy44OSw1Mi4xMS0uNjksMy4wNi0uNzcsMzEuMDMtLjAxLDMzLjU5LDEuMDMsMy40Nyw3LjcyLDMuMTQsMTAuNzUsMy43NWwuMDUsNi45NWgtMzkuNWMtNS43NC0xMC4yNCwzLjE2LTYuNTIsOC4yOS04LjY2LDMuOTItMS42NCwxLjc0LTI0Ljc0LDEuOTgtMjkuNjEtMTAuMi0xNy4xMy0xOC40LTM3LjM0LTI4Ljk3LTU0LjAzLTIuMDgtMy4yOS0zLjEyLTYuMjktNy43Ni01Ljc0bC0uMDUtNy45NmgzN1oiIGZpbGw9IiNGREY4RjAiLz48cGF0aCBkPSJNNDE2Ljc5LDEzMS44NGwtLjExLDYuOWMtMy43NiwxLjQ4LTkuOTEtLjMyLTEwLjg2LDQuNjNsLjE3LDgzLjc3Yy4yNi44OS45NiwxLjgsMS43OSwyLjIxLDEuOTMuOTQsMjAuMTkuODUsMjMuNTEuNSwxNC4xMS0xLjUxLDE0LjUzLTE1LjY2LDE1LjUtMjcuMDFsNi4zNi4xNWMzLjE3LDEuMDMuNjYsNy4zOS42LDEwLjMxLS4xOSw4LjMxLDEuMzUsMTYuMjcsMS4wNSwyNC41NWgtNzcuNWMtNi4zNi0xMC44NSw1LjAzLTYuMjIsOC44Ni04LjkxLDEuMTQtMS40NiwxLjQ1LTMuNzksMS42Mi01LjYsMS44NC0xOS42LDEuNDYtNTUuMTMuMDUtNzUuMDItLjExLTEuNTEtLjc0LTYuOTQtMS42NC03LjU3bC0xMC4yNi0yLjAzLS4xNC02Ljg2aDQxWiIgZmlsbD0iI0ZERjhGMCIvPjxwYXRoIGQ9Ik00MTcuNzksMjc1Ljg0bC0uMDUsNi45NS04LjkzLDEuNTYtMS45NSw0LjA1YzEuNDksMjUuNTUtMi4yMiw1My43NS0uMTEsNzguOTcuNTMsNi4zMywxLjQ4LDYuMDksNy41LDYuNSw2LjMxLjQzLDE5LjM3LjU1LDI0LjgyLTIuMjcsNy4xMy0zLjY5LDguMzMtMTcuNTMsOC43Mi0yNC43OGg4Yy0yLjQ5LDExLjM4LjI0LDIyLjU4LDAsMzQuMDFoLTc5bC40My02LjA3YzIuMDMtMi44NywxMC42MiwyLjQ2LDExLjYxLTguMzgsMS43MS0xOC43NiwxLjctNTcuMy0uMDYtNzYuMDQtLjEzLTEuMzYtLjYxLTQuOTEtMS42Mi01LjZsLTEwLjI1LTIuMDFjLS4zLTIuMzYtLjczLTUuMzMsMS4zOS02Ljg5aDM5LjVaIiBmaWxsPSIjRkRGOEYwIi8+PHBhdGggZD0iTTI3NC44LDI3NS44NHY3LjAxcy0xMC4wMywxLjQ4LTEwLjAzLDEuNDhsLTEuMDMsMi45Ny4wNSw4My4wNWMuODIsNC40Myw3LjUxLDMuNDksMTEuMDEsMy40OWwtLjk0LDcuNTctMzguNDIuMy0xLjUtMS41LS4xNS02LjM3LDEwLjAyLTEuNDhjMS4wNi0uOTQsMS44MS02LjI4LDEuOTctOC4wMywxLjY5LTE4LjM2LDEuNS01Mi41LjA1LTcxLjAyLS43NC05LjQ3LTEuOTEtMTEuMjgtMTIuMDQtMTAuNDZsLjk0LTcuNTcsNDAuMDcuNTZaIiBmaWxsPSIjRkRGOEYwIi8+PHBvbHlnb24gcG9pbnRzPSIyMzEuNzkgNTM2Ljg0IDIzMS43OSA2MTQuODQgMTc5LjI5IDU4OS4yMSAxMjUuNzkgNjE1Ljg0IDEyNS43OSA1MzYuODQgMjMxLjc5IDUzNi44NCIgZmlsbD0iI0U4NTg1OCIvPjxwYXRoIGQ9Ik0zMTQuNzksMzI5Ljg0aDE4LjVjMi43OSwwLDEwLjI3LDUuNDcsMTEuOTUsOC4wNSw0LjczLDcuMjcsMy42NiwyMy43NS0yLjkxLDI5Ljk5LTUuNDcsNS4yLTI3LjU0LDEwLjQ1LTI3LjU0LS41NHYtMzcuNVoiIGZpbGw9IiNBMzUyNEEiLz48cGF0aCBkPSJNMzE0Ljc5LDMyMi44NHYtMzQuNWMwLTguMzksMTYuNDktNi4yNCwyMS4zNi0yLjM2LDYuMzcsNS4wNiw1LjgxLDIyLjIxLDIuMTksMjguOTEtNS4wNSw5LjM1LTE0LjMyLDcuOTctMjMuNTUsNy45NVoiIGZpbGw9IiNBMzUyNEEiLz48cGF0aCBkPSJNMTcxLjc5LDMyOS44NGgxNy41YzQuMjQsMCwxMS4xMSw0Ljk4LDEzLjAxLDguOTksNS45NSwxMi40OCwyLjA3LDI5Ljc4LTEyLjQ2LDMzLjU3LTIuODguNzUtMTguMDYsMi43NC0xOC4wNi0yLjA2di00MC41WiIgZmlsbD0iI0EzNTI0QSIvPjxwYXRoIGQ9Ik0xNzEuNzksMzIyLjg0di0zNi41YzAtLjI4LDEuNTUtMi43MywyLTMsMTUuNi0yLjg5LDI0LjI3LDIuNTksMjQuMDgsMTkuMDFzLTEwLjAzLDIyLjE3LTI2LjA4LDIwLjQ5WiIgZmlsbD0iI0EzNTI0QSIvPjxwYXRoIGQ9Ik0zMTQuNTcsMTM3LjA3YzQuMDEtLjQyLDYuOTEuMzgsMTAuNTksMS45LDM0LjQ1LDE0LjIxLDI0Ljc0LDEwOS41Ni0xNi43Miw5MS43Mi0yOS4xOS0xMi41Ni0yNi44Ny05MC4xNiw2LjEzLTkzLjYyWiIgZmlsbD0iI0EzNTI0QSIvPjwvc3ZnPgo="
                  alt="Bible App"
                  className="w-full h-full"
                />
              </div>
              <span className="font-medium text-gray-900 dark:text-white">Open in Bible App</span>
            </button>
          )}

          <button
            onClick={handleOpenInChrome}
            className="flex items-center gap-3 w-full p-4 rounded-xl bg-gray-100 dark:bg-neutral-800 hover:bg-gray-200 dark:hover:bg-neutral-700 transition-colors"
          >
            <div className="w-10 h-10 rounded-full bg-white dark:bg-neutral-700 flex items-center justify-center shadow-sm">
              <img
                src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPgo8c3ZnIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHBhdGggZD0iTTE2LjAwMDUgMi4wMDM5NEMxNi4wMDA1IDIuMDAzOTQgMjQuMjUyNyAxLjYzNDk1IDI4LjYyNzggOS45MDAwMkgxNS4yOTgzQzE1LjI5ODMgOS45MDAwMiAxMi43ODI4IDkuODE5MjMgMTAuNjM0IDEyLjg2MDFDMTAuMDE2NyAxNC4xMzY0IDkuMzUzMiAxNS40NTExIDEwLjA5NzggMTguMDQyMkM5LjAyNTE3IDE2LjIzMTUgNC40MDMzMiA4LjIxMjQ2IDQuNDAzMzIgOC4yMTI0NkM0LjQwMzMyIDguMjEyNDYgNy42NjMzMiAyLjMzMDY5IDE2LjAwMDQgMi4wMDM5NEgxNi4wMDA1WiIgZmlsbD0iI0VGM0YzNiIvPg0KPHBhdGggZD0iTTI4LjE5OTQgMjIuOTg2QzI4LjE5OTQgMjIuOTg2IDI0LjM5MTUgMzAuMjkzOCAxNS4wMjQ0IDI5LjkzMjVDMTYuMTgxOCAyNy45MzczIDIxLjY5MSAxOC40MzA1IDIxLjY5MSAxOC40MzA1QzIxLjY5MSAxOC40MzA1IDIzLjAyMiAxNi4zMDA4IDIxLjQ1MTggMTIuOTI1NkMyMC42NTMxIDExLjc1MzEgMTkuODM5MSAxMC41MjY4IDE3LjIxNTcgOS44NzMyNEMxOS4zMjYxIDkuODU0MTMgMjguNjA0NSA5Ljg3MzI0IDI4LjYwNDUgOS44NzMyNEMyOC42MDQ1IDkuODczMjQgMzIuMDgwNSAxNS42MjgxIDI4LjE5OTQgMjIuOTg2WiIgZmlsbD0iI0ZDRDkwMCIvPg0KPHBhdGggZD0iTTMuODU5MzEgMjMuMDQzM0MzLjg1OTMxIDIzLjA0MzMgLTAuNTg4OTkyIDE2LjEwNDQgNC40MTA5NSA4LjIwMDY4QzUuNTY0NTIgMTAuMTk1OSAxMS4wNzM3IDE5LjcwMjcgMTEuMDczNyAxOS43MDI3QzExLjA3MzcgMTkuNzAyNyAxMi4yNjIgMjEuOTE3IDE1Ljk3NzIgMjIuMjQ3NUMxNy4zOTMyIDIyLjE0MzcgMTguODY2OSAyMi4wNTUzIDIwLjc0OTcgMjAuMTIxN0MxOS43MTE3IDIxLjk1MTYgMTUuMDU1MSAyOS45NDc2IDE1LjA1NTEgMjkuOTQ3NkMxNS4wNTUxIDI5Ljk0NzYgOC4zMTEzNCAzMC4wNzA2IDMuODU5MiAyMy4wNDMzSDMuODU5MzFaIiBmaWxsPSIjNjFCQzVCIi8+DQo8cGF0aCBkPSJNMTUuMDIwNSAzMC4wMDEzTDE2Ljg5NTUgMjIuMjA1M0MxNi44OTU1IDIyLjIwNTMgMTguOTU1NyAyMi4wNDM3IDIwLjY4NDIgMjAuMTU2MkMxOS42MTE1IDIyLjAzNjIgMTUuMDIwNSAzMC4wMDEzIDE1LjAyMDUgMzAuMDAxM1oiIGZpbGw9IiM1QUIwNTUiLz4NCjxwYXRoIGQ9Ik05LjcxOTczIDE2LjA4OUM5LjcxOTczIDEyLjY1MjMgMTIuNTE2OCA5Ljg2NTIzIDE1Ljk2NTggOS44NjUyM0MxOS40MTQ4IDkuODY1MjMgMjIuMjExOSAxMi42NTIzIDIyLjIxMTkgMTYuMDg5QzIyLjIxMTkgMTkuNTI1NyAxOS40MTQ4IDIyLjMxMjcgMTUuOTY1OCAyMi4zMTI3QzEyLjUxNjggMjIuMzA4OSA5LjcxOTczIDE5LjUyNTcgOS43MTk3MyAxNi4wODlaIiBmaWxsPSJ3aGl0ZSIvPg0KPHBhdGggZD0iTTEwLjc2NTYgMTYuMDg5MkMxMC43NjU2IDEzLjIyOTIgMTMuMDkyMSAxMC45MDcyIDE1Ljk2NjMgMTAuOTA3MkMxOC44MzY2IDEwLjkwNzIgMjEuMTY2OSAxMy4yMjU0IDIxLjE2NjkgMTYuMDg5MkMyMS4xNjY5IDE4Ljk0OTQgMTguODQwNiAyMS4yNzE0IDE1Ljk2NjMgMjEuMjcxNEMxMy4wOTU5IDIxLjI3MTQgMTAuNzY1NiAxOC45NDk0IDEwLjc2NTYgMTYuMDg5MloiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl84N183MDk4KSIvPg0KPHBhdGggZD0iTTI4LjYwMDcgOS44NzY3M0wyMC44ODA4IDEyLjEzMzNDMjAuODgwOCAxMi4xMzMzIDE5LjcxNTcgMTAuNDMwMiAxNy4yMTE5IDkuODc2NzNDMTkuMzg0IDkuODY1MTUgMjguNjAwNyA5Ljg3NjczIDI4LjYwMDcgOS44NzY3M1oiIGZpbGw9IiNFQUNBMDUiLz4NCjxwYXRoIGQ9Ik05Ljk0NzM1IDE3Ljc1NzdDOC44NjMxMyAxNS44ODU1IDQuNDAzMzIgOC4yMTI0IDQuNDAzMzIgOC4yMTI0TDEwLjEyMDkgMTMuODQ4MUMxMC4xMjA5IDEzLjg0ODEgOS41MzQ0MSAxNS4wNTE0IDkuNzU0NDEgMTYuNzczNUw5Ljk0NzI0IDE3Ljc1NzdIOS45NDczNVoiIGZpbGw9IiNERjNBMzIiLz4NCjxkZWZzPg0KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzg3XzcwOTgiIHgxPSIxNS45NjYxIiB5MT0iMTAuOTgwNCIgeDI9IjE1Ljk2NjEiIHkyPSIyMC45NTk0IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+DQo8c3RvcCBzdG9wLWNvbG9yPSIjODZCQkU1Ii8+DQo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMxMDcyQkEiLz4NCjwvbGluZWFyR3JhZGllbnQ+DQo8L2RlZnM+DQo8L3N2Zz4="
                alt="Chrome"
                className="w-7 h-7"
              />
            </div>
            <span className="font-medium text-gray-900 dark:text-white">Open in Chrome</span>
          </button>

          <button
            onClick={handleOpenInFirefox}
            className="flex items-center gap-3 w-full p-4 rounded-xl bg-gray-100 dark:bg-neutral-800 hover:bg-gray-200 dark:hover:bg-neutral-700 transition-colors"
          >
            <div className="w-10 h-10 rounded-full bg-white dark:bg-neutral-700 flex items-center justify-center shadow-sm">
              <img
                src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPgo8c3ZnIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHBhdGggZD0iTTI4Ljk5MDUgMTAuNzI2NUMyOC4zODE2IDkuMjU3NCAyNy4xNDczIDcuNjcxMzkgMjYuMTc4NCA3LjE3MDM5QzI2Ljk2NyA4LjcyMDE1IDI3LjQyMzIgMTAuMjc0NiAyNy41OTc2IDExLjQzNDRDMjcuNTk3NiAxMS40MzQ0IDI3LjU5NzYgMTEuNDQyNiAyNy42MDA1IDExLjQ1NzhDMjYuMDE1NiA3LjQ5Nzc3IDIzLjMyNzcgNS45MDA2NSAyMS4xMzI3IDIuNDI0MDdDMjEuMDIxMyAyLjI0ODY5IDIwLjkxMDUgMi4wNzMzMSAyMC44MDIgMS44ODU2NkMyMC43NDA3IDEuNzc5ODUgMjAuNjkxMSAxLjY4Mzk3IDIwLjY0OCAxLjU5MzM2QzIwLjU1NyAxLjQxNzU3IDIwLjQ4NjcgMS4yMzE3OSAyMC40Mzg2IDEuMDM5NzVDMjAuNDM5IDEuMDMwNjMgMjAuNDM1OSAxLjAyMTY5IDIwLjQzMDEgMS4wMTQ2N0MyMC40MjQzIDEuMDA3NjUgMjAuNDE2MSAxLjAwMzA1IDIwLjQwNzEgMS4wMDE3NUMyMC4zOTg1IDAuOTk5NDE2IDIwLjM4OTQgMC45OTk0MTYgMjAuMzgwOCAxLjAwMTc1QzIwLjM3ODUgMS4wMDI4MSAyMC4zNzYzIDEuMDA0MTkgMjAuMzc0NCAxLjAwNTg0QzIwLjM3MDkgMS4wMDU4NCAyMC4zNjc0IDEuMDA5OTQgMjAuMzYzOSAxLjAxMTFMMjAuMzY5NyAxLjAwMzVDMTYuODQ4MyAzLjA3MDYzIDE1LjY1MzYgNi44OTQ0NiAxNS41NDQgOC44MDc4NEMxNC4xMzY4IDguOTA0MjggMTIuNzkxMyA5LjQyMzU4IDExLjY4MyAxMC4yOThDMTEuNTY3MiAxMC4xOTk4IDExLjQ0NjEgMTAuMTA4MSAxMS4zMjAyIDEwLjAyMzJDMTEuMDAwOCA4LjkwMjcgMTAuOTg3MyA3LjcxNjgzIDExLjI4MTEgNi41ODkzMUM5Ljg0MDkxIDcuMjQ2OTcgOC43MjA5NSA4LjI4NDYzIDcuOTA2NjQgOS4yMDMwM0g3LjkwMDIzQzcuMzQ0MzMgOC40OTc0MiA3LjM4MzQxIDYuMTcwMTUgNy40MTQ5MSA1LjY4NDM1QzcuNDA4NDkgNS42NTM5NSA3LjAwMDc2IDUuODk2NTYgNi45NDgyNiA1LjkzMzM5QzYuNDU3NzMgNi4yODQxIDUuOTk5MiA2LjY3NzcxIDUuNTc4MDUgNy4xMDk2QzUuMDk4OCA3LjU5NjU1IDQuNjYwOTYgOC4xMjI3NiA0LjI2OTA5IDguNjgyNzRDMy4zNjc1MiA5Ljk2MzIzIDIuNzI4MTQgMTEuNDEwMSAyLjM4NzkgMTIuOTM5OEMyLjM4MTQ5IDEyLjk3MDIgMi4zNzU2NSAxMy4wMDE3IDIuMzY5MjQgMTMuMDMyN0MyLjM0Mjk5IDEzLjE1NjEgMi4yNDc5MSAxMy43NzUxIDIuMjMwOTkgMTMuOTA5NlYxMy45NDA2QzIuMTA3MDQgMTQuNTgwMyAyLjAyOTg0IDE1LjIyODIgMiAxNS44NzkxVjE1Ljk1MUMyIDIzLjcwOTcgOC4yNzY0NiAzMCAxNi4wMTgyIDMwQzIyLjk1MjEgMzAgMjguNzA4OCAyNC45NTQ5IDI5LjgzNjQgMTguMzI4QzI5Ljg1OTcgMTguMTQ4NSAyOS44Nzg5IDE3Ljk2NzMgMjkuODk5OSAxNy43ODZDMzAuMTc4OCAxNS4zNzYzIDI5Ljg2OSAxMi44NDM5IDI4Ljk5MDUgMTAuNzI2NVpNMTIuODMyNyAyMS43MjM5QzEyLjg5ODEgMjEuNzU0OSAxMi45NTk5IDIxLjc4OTQgMTMuMDI3IDIxLjgxOTdMMTMuMDM2MyAyMS44MjU2QzEyLjk2OTIgMjEuNzkyOSAxMi45MDEgMjEuNzU5IDEyLjgzMzMgMjEuNzIzOUgxMi44MzI3Wk0yNy42MDE3IDExLjQ2NDJWMTEuNDUwOFYxMS40NjZWMTEuNDY0MloiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl84N183MTE4KSIvPg0KPHBhdGggZD0iTTI4Ljk5MDcgMTAuNzI2NUMyOC4zODE4IDkuMjU3NDEgMjcuMTQ3NSA3LjY3MTQxIDI2LjE3ODYgNy4xNzA0MUMyNi45NjcyIDguNzIwMTcgMjcuNDIzNCAxMC4yNzQ2IDI3LjU5NzggMTEuNDM0NFYxMS40NjMxQzI4LjkyMDggMTUuMDU3MiAyOC4xOTk4IDE4LjcxMjEgMjcuMTYxNSAyMC45NDUyQzI1LjU1NSAyNC40MDAyIDIxLjY2NjEgMjcuOTQxNiAxNS41NzggMjcuNzY5MkM5LjAwNTgxIDI3LjU4MjEgMy4yMTE3NSAyMi42ODg1IDIuMTI5NyAxNi4yODQyQzEuOTMyNTQgMTUuMjczNSAyLjEyOTcgMTQuNzYwOCAyLjIyODg2IDEzLjk0MDZDMi4xMDgxMiAxNC41NzI1IDIuMDYyMDMgMTQuNzU1NSAyLjAwMTk1IDE1Ljg3OTFWMTUuOTUxQzIuMDAxOTUgMjMuNzA5OCA4LjI3ODQyIDMwIDE2LjAyMDIgMzBDMjIuOTU0IDMwIDI4LjcxMDggMjQuOTU0OSAyOS44MzgzIDE4LjMyOEMyOS44NjE2IDE4LjE0ODUgMjkuODgwOSAxNy45NjczIDI5LjkwMTkgMTcuNzg2MUMzMC4xNzkgMTUuMzc2NCAyOS44NjkyIDEyLjg0MzkgMjguOTkwNyAxMC43MjY1WiIgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsXzg3XzcxMTgpIi8+DQo8cGF0aCBkPSJNMjguOTkwNyAxMC43MjY1QzI4LjM4MTggOS4yNTc0MSAyNy4xNDc1IDcuNjcxNDEgMjYuMTc4NiA3LjE3MDQxQzI2Ljk2NzIgOC43MjAxNyAyNy40MjM0IDEwLjI3NDYgMjcuNTk3OCAxMS40MzQ0VjExLjQ2MzFDMjguOTIwOCAxNS4wNTcyIDI4LjE5OTggMTguNzEyMSAyNy4xNjE1IDIwLjk0NTJDMjUuNTU1IDI0LjQwMDIgMjEuNjY2MSAyNy45NDE2IDE1LjU3OCAyNy43NjkyQzkuMDA1ODEgMjcuNTgyMSAzLjIxMTc1IDIyLjY4ODUgMi4xMjk3IDE2LjI4NDJDMS45MzI1NCAxNS4yNzM1IDIuMTI5NyAxNC43NjA4IDIuMjI4ODYgMTMuOTQwNkMyLjEwODEyIDE0LjU3MjUgMi4wNjIwMyAxNC43NTU1IDIuMDAxOTUgMTUuODc5MVYxNS45NTFDMi4wMDE5NSAyMy43MDk4IDguMjc4NDIgMzAgMTYuMDIwMiAzMEMyMi45NTQgMzAgMjguNzEwOCAyNC45NTQ5IDI5LjgzODMgMTguMzI4QzI5Ljg2MTYgMTguMTQ4NSAyOS44ODA5IDE3Ljk2NzMgMjkuOTAxOSAxNy43ODYxQzMwLjE3OSAxNS4zNzY0IDI5Ljg2OTIgMTIuODQzOSAyOC45OTA3IDEwLjcyNjVaIiBmaWxsPSJ1cmwoI3BhaW50Ml9yYWRpYWxfODdfNzExOCkiLz4NCjxwYXRoIGQ9Ik0yMi4xNzc2IDEyLjM3NzNDMjIuMjA4NSAxMi4zOTg5IDIyLjIzNTkgMTIuNDIwNSAyMi4yNjUxIDEyLjQ0MjJDMjEuOTEzMyAxMS44MTYxIDIxLjQ3NDkgMTEuMjQzIDIwLjk2MzEgMTAuNzM5OEMxNi42MDU4IDYuMzcyOTIgMTkuODIxIDEuMjcwNTggMjAuMzYyOSAxLjAxMTAyTDIwLjM2ODcgMS4wMDM0MkMxNi44NDczIDMuMDcwNTQgMTUuNjUyNiA2Ljg5NDM4IDE1LjU0MyA4LjgwNzc2QzE1LjcwNjMgOC43OTY2NSAxNS44NjkgOC43ODI2MiAxNi4wMzUzIDguNzgyNjJDMTguNjYzMSA4Ljc4MjYyIDIwLjk1MiAxMC4yMzEyIDIyLjE3NzYgMTIuMzc3M1oiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF84N183MTE4KSIvPg0KPHBhdGggZD0iTTE2LjA0NDYgMTMuMjQ5OUMxNi4wMjE5IDEzLjYwMDYgMTQuNzg5OSAxNC44MDQ5IDE0LjM1ODkgMTQuODA0OUMxMC4zNzI1IDE0LjgwNDkgOS43MjU1OSAxNy4yMjE2IDkuNzI1NTkgMTcuMjIxNkM5LjkwMDU4IDE5LjI1NzIgMTEuMzE1NyAyMC45MzMyIDEzLjAyNzcgMjEuODJDMTMuMTA1OSAyMS44NjA0IDEzLjE4NDYgMjEuODk2NiAxMy4yNjExIDIxLjkzMjlDMTMuMzk4MSAyMS45OTEzIDEzLjUzNTggMjIuMDQ5OCAxMy42NzI5IDIyLjEwMThDMTQuMjYgMjIuMzA5NCAxNC44NzQ4IDIyLjQyNzYgMTUuNDk2OSAyMi40NTI2QzIyLjQ4MzggMjIuNzgxMSAyMy44MzgzIDE0LjA4IDE4Ljc5NTUgMTEuNTUzNEMyMC4wODY0IDExLjMyODMgMjEuNDI2OSAxMS44NDkyIDIyLjE3NTMgMTIuMzc1OUMyMC45NTAzIDEwLjIyOTkgMTguNjYwOCA4Ljc4MTI1IDE2LjAzMyA4Ljc4MTI1QzE1Ljg2NjcgOC43ODEyNSAxNS43MDQgOC43OTUyOCAxNS41NDA2IDguODA2MzlDMTQuMTM0NSA4LjkwNDAzIDEyLjc5MDMgOS40MjM5IDExLjY4MzIgMTAuMjk4M0MxMS44OTczIDEwLjQ4MDEgMTIuMTM4OCAxMC43MjIxIDEyLjY0NjggMTEuMjIzN0MxMy42IDEyLjE2NjEgMTYuMDM5NCAxMy4xMzU5IDE2LjA0NDYgMTMuMjQ5OVoiIGZpbGw9InVybCgjcGFpbnQ0X3JhZGlhbF84N183MTE4KSIvPg0KPHBhdGggZD0iTTE2LjA0NDYgMTMuMjQ5OUMxNi4wMjE5IDEzLjYwMDYgMTQuNzg5OSAxNC44MDQ5IDE0LjM1ODkgMTQuODA0OUMxMC4zNzI1IDE0LjgwNDkgOS43MjU1OSAxNy4yMjE2IDkuNzI1NTkgMTcuMjIxNkM5LjkwMDU4IDE5LjI1NzIgMTEuMzE1NyAyMC45MzMyIDEzLjAyNzcgMjEuODJDMTMuMTA1OSAyMS44NjA0IDEzLjE4NDYgMjEuODk2NiAxMy4yNjExIDIxLjkzMjlDMTMuMzk4MSAyMS45OTEzIDEzLjUzNTggMjIuMDQ5OCAxMy42NzI5IDIyLjEwMThDMTQuMjYgMjIuMzA5NCAxNC44NzQ4IDIyLjQyNzYgMTUuNDk2OSAyMi40NTI2QzIyLjQ4MzggMjIuNzgxMSAyMy44MzgzIDE0LjA4IDE4Ljc5NTUgMTEuNTUzNEMyMC4wODY0IDExLjMyODMgMjEuNDI2OSAxMS44NDkyIDIyLjE3NTMgMTIuMzc1OUMyMC45NTAzIDEwLjIyOTkgMTguNjYwOCA4Ljc4MTI1IDE2LjAzMyA4Ljc4MTI1QzE1Ljg2NjcgOC43ODEyNSAxNS43MDQgOC43OTUyOCAxNS41NDA2IDguODA2MzlDMTQuMTM0NSA4LjkwNDAzIDEyLjc5MDMgOS40MjM5IDExLjY4MzIgMTAuMjk4M0MxMS44OTczIDEwLjQ4MDEgMTIuMTM4OCAxMC43MjIxIDEyLjY0NjggMTEuMjIzN0MxMy42IDEyLjE2NjEgMTYuMDM5NCAxMy4xMzU5IDE2LjA0NDYgMTMuMjQ5OVoiIGZpbGw9InVybCgjcGFpbnQ1X3JhZGlhbF84N183MTE4KSIvPg0KPHBhdGggZD0iTTExLjAzMTEgOS44MzA5M0MxMS4xNDQ4IDkuOTA0NTkgMTEuMjM4MiA5Ljk2NjU2IDExLjMyMjcgMTAuMDIzM0MxMS4wMDM0IDguOTAyNzUgMTAuOTg5OSA3LjcxNjg4IDExLjI4MzcgNi41ODkzNkM5Ljg0MzQ1IDcuMjQ3MDIgOC43MjM0OSA4LjI4NDY4IDcuOTA5MTggOS4yMDMwOEM3Ljk3NTA5IDkuMjAxMzIgMTAuMDA4NSA5LjE2NDQ5IDExLjAzMTEgOS44MzA5M1oiIGZpbGw9InVybCgjcGFpbnQ2X3JhZGlhbF84N183MTE4KSIvPg0KPHBhdGggZD0iTTIuMTI5NyAxNi4yODRDMy4yMTE3NSAyMi42ODgzIDkuMDA1ODEgMjcuNTgxOSAxNS41ODI3IDI3Ljc2OUMyMS42NzA3IDI3Ljk0MTQgMjUuNTU3NCAyNC40IDI3LjE2NjEgMjAuOTQ1QzI4LjIwNDQgMTguNzExMyAyOC45MjU0IDE1LjA1NyAyNy42MDI1IDExLjQ2MjlWMTEuNDM2QzI3LjYwMjUgMTEuNDM5NSAyNy42MDI1IDExLjQ0NDIgMjcuNjA1NCAxMS40NTk0QzI4LjEwMjQgMTQuNzEzOCAyNi40NTEgMTcuODY2NSAyMy44NjkyIDE5Ljk5ODZDMjMuODY2NiAyMC4wMDQ1IDIzLjg2NDEgMjAuMDEwNiAyMy44NjE3IDIwLjAxNjdDMTguODMwNiAyNC4xMjIzIDE0LjAxNjUgMjIuNDkzNiAxMy4wNDE4IDIxLjgyODlDMTIuOTc0MSAyMS43OTYyIDEyLjkwNTkgMjEuNzYyMyAxMi44MzgyIDIxLjcyNzJDOS45MDQ3IDIwLjMyNDIgOC42OTMxNiAxNy42NDM4IDguOTUyNzMgMTUuMzQ2OUM2LjQ3NjU2IDE1LjM0NjkgNS42MzE5MiAxMy4yNTI5IDUuNjMxOTIgMTMuMjUyOUM1LjYzMTkyIDEzLjI1MjkgNy44NTU1MiAxMS42NjQgMTAuNzg2MSAxMy4wNDZDMTMuNTAwMyAxNC4zMjYyIDE2LjA0OTMgMTMuMjUzNSAxNi4wNDkzIDEzLjI1MjlDMTYuMDQ0MSAxMy4xMzg5IDEzLjYwNDcgMTIuMTY2MiAxMi42NTMzIDExLjIyNjdDMTIuMTQ1MiAxMC43MjUxIDExLjkwMzcgMTAuNDgzMSAxMS42ODk2IDEwLjMwMTNDMTEuNTczOCAxMC4yMDMxIDExLjQ1MjcgMTAuMTExNCAxMS4zMjY4IDEwLjAyNjVDMTEuMjQzNCA5Ljk2ODA5IDExLjE1MTggOS45MDk2MyAxMS4wMzUyIDkuODM0MjFDMTAuMDEyNiA5LjE2Nzc4IDcuOTc5MTggOS4yMDQ2MSA3LjkxMjEgOS4yMDYzNkg3LjkwNTY4QzcuMzQ5NzggOC41MDA3NiA3LjM4ODg2IDYuMTczNDggNy40MjAzNiA1LjY4NzY5QzcuNDEzOTUgNS42NTcyOSA3LjAwNjIxIDUuODk5ODkgNi45NTM3MSA1LjkzNjcyQzYuNDYzMTggNi4yODc0MyA2LjAwNDY1IDYuNjgxMDQgNS41ODM1MSA3LjExMjkzQzUuMTA0MjYgNy41OTk4OCA0LjY2NjQyIDguMTI2MDkgNC4yNzQ1NSA4LjY4NjA3QzMuMzcyOTggOS45NjY1NyAyLjczMzYgMTEuNDEzNCAyLjM5MzM2IDEyLjk0MzFDMi4zODIyOCAxMi45NyAxLjg4MzU0IDE1LjE1MjMgMi4xMjk3IDE2LjI4NFoiIGZpbGw9InVybCgjcGFpbnQ3X3JhZGlhbF84N183MTE4KSIvPg0KPHBhdGggZD0iTTIwLjk2MzQgMTAuNzM5OUMyMS40NzUyIDExLjI0MzEgMjEuOTEzNSAxMS44MTYyIDIyLjI2NTMgMTIuNDQyM0MyMi4zMzgzIDEyLjQ5NzEgMjIuNDA4MyAxMi41NTU3IDIyLjQ3NTMgMTIuNjE3NkMyNS42NTMyIDE1LjU1IDIzLjk5MDggMTkuNzAxMiAyMy44NjQyIDE5Ljk5OTNDMjYuNDQ2IDE3Ljg2NzMgMjguMDk3MyAxNC43MTQ2IDI3LjYwMDMgMTEuNDYwMUMyNi4wMTU1IDcuNDk3NzcgMjMuMzI3NiA1LjkwMDY1IDIxLjEzMjUgMi40MjQwN0MyMS4wMjExIDIuMjQ4NjkgMjAuOTEwMyAyLjA3MzMxIDIwLjgwMTggMS44ODU2NkMyMC43NDA2IDEuNzc5ODUgMjAuNjkxIDEuNjgzOTcgMjAuNjQ3OCAxLjU5MzM2QzIwLjU1NjkgMS40MTc1NyAyMC40ODY2IDEuMjMxNzkgMjAuNDM4NCAxLjAzOTc1QzIwLjQzODggMS4wMzA2MyAyMC40MzU4IDEuMDIxNjkgMjAuNDMgMS4wMTQ2N0MyMC40MjQxIDEuMDA3NjUgMjAuNDE1OSAxLjAwMzA1IDIwLjQwNjkgMS4wMDE3NUMyMC4zOTgzIDAuOTk5NDE2IDIwLjM4OTMgMC45OTk0MTYgMjAuMzgwNyAxLjAwMTc1QzIwLjM3ODMgMS4wMDI4MSAyMC4zNzYyIDEuMDA0MTkgMjAuMzc0MiAxLjAwNTg0QzIwLjM3MDcgMS4wMDU4NCAyMC4zNjcyIDEuMDA5OTQgMjAuMzYzNyAxLjAxMTFDMTkuODIxMyAxLjI3MDY2IDE2LjYwNiA2LjM3MzAxIDIwLjk2MzQgMTAuNzM5OVoiIGZpbGw9InVybCgjcGFpbnQ4X3JhZGlhbF84N183MTE4KSIvPg0KPHBhdGggZD0iTTIyLjQ3NDMgMTIuNjE0NkMyMi40MDczIDEyLjU1MjYgMjIuMzM3MiAxMi40OTQxIDIyLjI2NDMgMTIuNDM5MkMyMi4yMzU3IDEyLjQxNzYgMjIuMjA2IDEyLjM5NiAyMi4xNzY4IDEyLjM3NDNDMjEuNDI4NCAxMS44NDgyIDIwLjA4OCAxMS4zMjY3IDE4Ljc5NzEgMTEuNTUxOEMyMy44MzkzIDE0LjA3ODQgMjIuNDg1NCAyMi43Nzk1IDE1LjQ5ODUgMjIuNDUxQzE0Ljg3NjQgMjIuNDI2IDE0LjI2MTYgMjIuMzA3OCAxMy42NzQ0IDIyLjEwMDJDMTMuNTM3NCAyMi4wNDg4IDEzLjM5OTcgMjEuOTkyMSAxMy4yNjI2IDIxLjkzMTNDMTMuMTgzMyAyMS44OTUgMTMuMTA0NSAyMS44NTg4IDEzLjAyOTMgMjEuODE4NUwxMy4wMzg2IDIxLjgyNDNDMTQuMDEzMyAyMi40OTA4IDE4LjgyNzQgMjQuMTE5NCAyMy44NTg1IDIwLjAxMjFDMjMuODU4NSAyMC4wMTIxIDIzLjg2MTQgMjAuMDA0NSAyMy44NjYxIDE5Ljk5MzlDMjMuOTkwOSAxOS43MDExIDI1LjY1MzQgMTUuNTQ5OSAyMi40NzQzIDEyLjYxNDZaIiBmaWxsPSJ1cmwoI3BhaW50OV9yYWRpYWxfODdfNzExOCkiLz4NCjxwYXRoIGQ9Ik05LjcyNTMyIDE3LjIyMTVDOS43MjUzMiAxNy4yMjE1IDEwLjM3MjIgMTQuODA0OCAxNC4zNTg2IDE0LjgwNDhDMTQuNzg5NyAxNC44MDQ4IDE2LjAyMTYgMTMuNTk5NCAxNi4wNDQ0IDEzLjI0OThDMTYuMDY3MSAxMi45MDAyIDEzLjQ5NTMgMTQuMzIzMSAxMC43ODExIDEzLjA0MjhDNy44NTA1NSAxMS42NjA4IDUuNjI2OTUgMTMuMjQ5OCA1LjYyNjk1IDEzLjI0OThDNS42MjY5NSAxMy4yNDk4IDYuNDcxNTkgMTUuMzQzOCA4Ljk0Nzc2IDE1LjM0MzhDOC42ODgxOSAxNy42NDA3IDkuODk5NzMgMjAuMzE4NyAxMi44MzMyIDIxLjcyNDFDMTIuODk4NiAyMS43NTUgMTIuOTYwNCAyMS43ODk1IDEzLjAyNzUgMjEuODE5OUMxMS4zMTU0IDIwLjkzNDkgOS45MDIwNyAxOS4yNTcxIDkuNzI1MzIgMTcuMjIxNVoiIGZpbGw9InVybCgjcGFpbnQxMF9yYWRpYWxfODdfNzExOCkiLz4NCjxwYXRoIGQ9Ik0yOC45OTA1IDEwLjcyNjVDMjguMzgxNiA5LjI1NzQgMjcuMTQ3MyA3LjY3MTM5IDI2LjE3ODQgNy4xNzAzOUMyNi45NjcgOC43MjAxNSAyNy40MjMyIDEwLjI3NDYgMjcuNTk3NiAxMS40MzQ0QzI3LjU5NzYgMTEuNDM0NCAyNy41OTc2IDExLjQ0MjYgMjcuNjAwNSAxMS40NTc4QzI2LjAxNTYgNy40OTc3NyAyMy4zMjc3IDUuOTAwNjUgMjEuMTMyNyAyLjQyNDA3QzIxLjAyMTMgMi4yNDg2OSAyMC45MTA1IDIuMDczMzEgMjAuODAyIDEuODg1NjZDMjAuNzQwNyAxLjc3OTg1IDIwLjY5MTEgMS42ODM5NyAyMC42NDggMS41OTMzNkMyMC41NTcgMS40MTc1NyAyMC40ODY3IDEuMjMxNzkgMjAuNDM4NiAxLjAzOTc1QzIwLjQzOSAxLjAzMDYzIDIwLjQzNTkgMS4wMjE2OSAyMC40MzAxIDEuMDE0NjdDMjAuNDI0MyAxLjAwNzY1IDIwLjQxNjEgMS4wMDMwNSAyMC40MDcxIDEuMDAxNzVDMjAuMzk4NSAwLjk5OTQxNiAyMC4zODk0IDAuOTk5NDE2IDIwLjM4MDggMS4wMDE3NUMyMC4zNzg1IDEuMDAyODEgMjAuMzc2MyAxLjAwNDE5IDIwLjM3NDQgMS4wMDU4NEMyMC4zNzA5IDEuMDA1ODQgMjAuMzY3NCAxLjAwOTk0IDIwLjM2MzkgMS4wMTExTDIwLjM2OTcgMS4wMDM1QzE2Ljg0ODMgMy4wNzA2MyAxNS42NTM2IDYuODk0NDYgMTUuNTQ0IDguODA3ODRDMTUuNzA3MyA4Ljc5NjczIDE1Ljg3MDEgOC43ODI3MSAxNi4wMzYzIDguNzgyNzFDMTguNjY0MSA4Ljc4MjcxIDIwLjk1MzEgMTAuMjMxMyAyMi4xNzg2IDEyLjM3NzRDMjEuNDMwMiAxMS44NTEyIDIwLjA4OTggMTEuMzI5OCAxOC43OTg5IDExLjU1NDlDMjMuODQxIDE0LjA4MTUgMjIuNDg3MiAyMi43ODI2IDE1LjUwMDIgMjIuNDU0QzE0Ljg3ODIgMjIuNDI5IDE0LjI2MzMgMjIuMzEwOCAxMy42NzYyIDIyLjEwMzNDMTMuNTM5MSAyMi4wNTE4IDEzLjQwMTUgMjEuOTk1MSAxMy4yNjQ0IDIxLjkzNDNDMTMuMTg1MSAyMS44OTgxIDEzLjEwNjMgMjEuODYxOCAxMy4wMzExIDIxLjgyMTVMMTMuMDQwNCAyMS44MjczQzEyLjk3MjcgMjEuNzk0NiAxMi45MDQ1IDIxLjc2MDcgMTIuODM2OCAyMS43MjU2QzEyLjkwMjEgMjEuNzU2NiAxMi45NjQgMjEuNzkxMSAxMy4wMzExIDIxLjgyMTVDMTEuMzE1NSAyMC45MzQ3IDkuOTAyMTYgMTkuMjU2OSA5LjcyNTQyIDE3LjIyMTNDOS43MjU0MiAxNy4yMjEzIDEwLjM3MjMgMTQuODA0NiAxNC4zNTg3IDE0LjgwNDZDMTQuNzg5OCAxNC44MDQ2IDE2LjAyMTcgMTMuNTk5MiAxNi4wNDQ1IDEzLjI0OTZDMTYuMDM5MiAxMy4xMzU2IDEzLjU5OTggMTIuMTYyOCAxMi42NDg0IDExLjIyMzRDMTIuMTQwMyAxMC43MjE4IDExLjg5ODggMTAuNDc5OCAxMS42ODQ4IDEwLjI5OEMxMS41Njg5IDEwLjE5OTggMTEuNDQ3OCAxMC4xMDgxIDExLjMyMTkgMTAuMDIzMkMxMS4wMDI2IDguOTAyNyAxMC45ODkxIDcuNzE2ODMgMTEuMjgyOSA2LjU4OTMxQzkuODQyNjYgNy4yNDY5NyA4LjcyMjcgOC4yODQ2MyA3LjkwODM5IDkuMjAzMDNINy45MDE5OEM3LjM0NjA4IDguNDk3NDIgNy4zODUxNiA2LjE3MDE1IDcuNDE2NjYgNS42ODQzNUM3LjQxMDI0IDUuNjUzOTUgNy4wMDI1MSA1Ljg5NjU2IDYuOTUwMDEgNS45MzMzOUM2LjQ1OTQ4IDYuMjg0MSA2LjAwMDk1IDYuNjc3NzEgNS41Nzk4IDcuMTA5NkM1LjEwMDU1IDcuNTk2NTUgNC42NjI3MSA4LjEyMjc2IDQuMjcwODQgOC42ODI3NEMzLjM2OTI3IDkuOTYzMjMgMi43Mjk4OSAxMS40MTAxIDIuMzg5NjUgMTIuOTM5OEMyLjM4MzI0IDEyLjk3MDIgMi4zNzc0IDEzLjAwMTcgMi4zNzA5OSAxMy4wMzI3QzIuMzQ0NzQgMTMuMTU2MSAyLjIyNTc0IDEzLjc4MzkgMi4yMDk0MSAxMy45MTg0QzIuMjA5NDEgMTMuOTI4OSAyLjIwOTQxIDEzLjkwODQgMi4yMDk0MSAxMy45MTg0QzIuMTAwMTkgMTQuNTY3MSAyLjAzMDI2IDE1LjIyMTkgMiAxNS44NzkxVjE1Ljk1MUMyIDIzLjcwOTcgOC4yNzY0NiAzMCAxNi4wMTgyIDMwQzIyLjk1MjEgMzAgMjguNzA4OCAyNC45NTQ5IDI5LjgzNjQgMTguMzI4QzI5Ljg1OTcgMTguMTQ4NSAyOS44Nzg5IDE3Ljk2NzMgMjkuODk5OSAxNy43ODZDMzAuMTc4OCAxNS4zNzYzIDI5Ljg2OSAxMi44NDM5IDI4Ljk5MDUgMTAuNzI2NVpNMjcuNTk5OSAxMS40NDc5VjExLjQ2MzFWMTEuNDQ3OVoiIGZpbGw9InVybCgjcGFpbnQxMV9saW5lYXJfODdfNzExOCkiLz4NCjxkZWZzPg0KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzg3XzcxMTgiIHgxPSIyNy4xMzUiIHkxPSI1LjQ5MjYxIiB4Mj0iMy44MTM5MiIgeTI9IjI3Ljk0MzciIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4NCjxzdG9wIG9mZnNldD0iMC4wNSIgc3RvcC1jb2xvcj0iI0ZGRjQ0RiIvPg0KPHN0b3Agb2Zmc2V0PSIwLjExIiBzdG9wLWNvbG9yPSIjRkZFODQ3Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuMjIiIHN0b3AtY29sb3I9IiNGRkM4MzAiLz4NCjxzdG9wIG9mZnNldD0iMC4zNyIgc3RvcC1jb2xvcj0iI0ZGOTgwRSIvPg0KPHN0b3Agb2Zmc2V0PSIwLjQiIHN0b3AtY29sb3I9IiNGRjhCMTYiLz4NCjxzdG9wIG9mZnNldD0iMC40NiIgc3RvcC1jb2xvcj0iI0ZGNjcyQSIvPg0KPHN0b3Agb2Zmc2V0PSIwLjUzIiBzdG9wLWNvbG9yPSIjRkYzNjQ3Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuNyIgc3RvcC1jb2xvcj0iI0UzMTU4NyIvPg0KPC9saW5lYXJHcmFkaWVudD4NCjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQxX3JhZGlhbF84N183MTE4IiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjA1OTYgNC4yMTg3OSkgc2NhbGUoMjkuMjI0NiAyOS4yODg4KSI+DQo8c3RvcCBvZmZzZXQ9IjAuMTMiIHN0b3AtY29sb3I9IiNGRkJENEYiLz4NCjxzdG9wIG9mZnNldD0iMC4xOSIgc3RvcC1jb2xvcj0iI0ZGQUMzMSIvPg0KPHN0b3Agb2Zmc2V0PSIwLjI1IiBzdG9wLWNvbG9yPSIjRkY5RDE3Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuMjgiIHN0b3AtY29sb3I9IiNGRjk4MEUiLz4NCjxzdG9wIG9mZnNldD0iMC40IiBzdG9wLWNvbG9yPSIjRkY1NjNCIi8+DQo8c3RvcCBvZmZzZXQ9IjAuNDciIHN0b3AtY29sb3I9IiNGRjM3NTAiLz4NCjxzdG9wIG9mZnNldD0iMC43MSIgc3RvcC1jb2xvcj0iI0Y1MTU2QyIvPg0KPHN0b3Agb2Zmc2V0PSIwLjc4IiBzdG9wLWNvbG9yPSIjRUIwODc4Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuODYiIHN0b3AtY29sb3I9IiNFNTAwODAiLz4NCjwvcmFkaWFsR3JhZGllbnQ+DQo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50Ml9yYWRpYWxfODdfNzExOCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgxNS4zODA5IDE2LjE5MjUpIHNjYWxlKDI5LjIyNDYgMjkuMjg4OCkiPg0KPHN0b3Agb2Zmc2V0PSIwLjMiIHN0b3AtY29sb3I9IiM5NjBFMTgiLz4NCjxzdG9wIG9mZnNldD0iMC4zNSIgc3RvcC1jb2xvcj0iI0IxMTkyNyIgc3RvcC1vcGFjaXR5PSIwLjc0Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuNDMiIHN0b3AtY29sb3I9IiNEQjI5M0QiIHN0b3Atb3BhY2l0eT0iMC4zNCIvPg0KPHN0b3Agb2Zmc2V0PSIwLjUiIHN0b3AtY29sb3I9IiNGNTMzNEIiIHN0b3Atb3BhY2l0eT0iMC4wOSIvPg0KPHN0b3Agb2Zmc2V0PSIwLjUzIiBzdG9wLWNvbG9yPSIjRkYzNzUwIiBzdG9wLW9wYWNpdHk9IjAiLz4NCjwvcmFkaWFsR3JhZGllbnQ+DQo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50M19yYWRpYWxfODdfNzExOCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgxOC45MDQgLTIuNDI4MTUpIHNjYWxlKDIxLjE3MiAyMS4yMTg0KSI+DQo8c3RvcCBvZmZzZXQ9IjAuMTMiIHN0b3AtY29sb3I9IiNGRkY0NEYiLz4NCjxzdG9wIG9mZnNldD0iMC4yNSIgc3RvcC1jb2xvcj0iI0ZGREMzRSIvPg0KPHN0b3Agb2Zmc2V0PSIwLjUxIiBzdG9wLWNvbG9yPSIjRkY5RDEyIi8+DQo8c3RvcCBvZmZzZXQ9IjAuNTMiIHN0b3AtY29sb3I9IiNGRjk4MEUiLz4NCjwvcmFkaWFsR3JhZGllbnQ+DQo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50NF9yYWRpYWxfODdfNzExOCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgxMi4xNDg3IDIzLjg0MzMpIHNjYWxlKDEzLjkxNSAxMy45NDU1KSI+DQo8c3RvcCBvZmZzZXQ9IjAuMzUiIHN0b3AtY29sb3I9IiMzQThFRTYiLz4NCjxzdG9wIG9mZnNldD0iMC40NyIgc3RvcC1jb2xvcj0iIzVDNzlGMCIvPg0KPHN0b3Agb2Zmc2V0PSIwLjY3IiBzdG9wLWNvbG9yPSIjOTA1OUZGIi8+DQo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNDMTM5RTYiLz4NCjwvcmFkaWFsR3JhZGllbnQ+DQo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50NV9yYWRpYWxfODdfNzExOCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgxNS44MDA1IDEyLjcxMTkpIHJvdGF0ZSgtMTMuOTI2NSkgc2NhbGUoNy4zNzMxNiA4LjY3ODUyKSI+DQo8c3RvcCBvZmZzZXQ9IjAuMjEiIHN0b3AtY29sb3I9IiM5MDU5RkYiIHN0b3Atb3BhY2l0eT0iMCIvPg0KPHN0b3Agb2Zmc2V0PSIwLjI4IiBzdG9wLWNvbG9yPSIjOEM0RkYzIiBzdG9wLW9wYWNpdHk9IjAuMDYiLz4NCjxzdG9wIG9mZnNldD0iMC43NSIgc3RvcC1jb2xvcj0iIzc3MTZBOCIgc3RvcC1vcGFjaXR5PSIwLjQ1Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuOTciIHN0b3AtY29sb3I9IiM2RTAwOEIiIHN0b3Atb3BhY2l0eT0iMC42Ii8+DQo8L3JhZGlhbEdyYWRpZW50Pg0KPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDZfcmFkaWFsXzg3XzcxMTgiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUuMDExIDMuMDIwNDEpIHNjYWxlKDEwLjAxMDggMTAuMDMyOCkiPg0KPHN0b3Agc3RvcC1jb2xvcj0iI0ZGRTIyNiIvPg0KPHN0b3Agb2Zmc2V0PSIwLjEyIiBzdG9wLWNvbG9yPSIjRkZEQjI3Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuMyIgc3RvcC1jb2xvcj0iI0ZGQzgyQSIvPg0KPHN0b3Agb2Zmc2V0PSIwLjUiIHN0b3AtY29sb3I9IiNGRkE5MzAiLz4NCjxzdG9wIG9mZnNldD0iMC43MyIgc3RvcC1jb2xvcj0iI0ZGN0UzNyIvPg0KPHN0b3Agb2Zmc2V0PSIwLjc5IiBzdG9wLWNvbG9yPSIjRkY3MTM5Ii8+DQo8L3JhZGlhbEdyYWRpZW50Pg0KPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDdfcmFkaWFsXzg3XzcxMTgiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjIuODgwNSAtMy4zNDMxMykgc2NhbGUoNDIuNzEwOSA0Mi44MDQ2KSI+DQo8c3RvcCBvZmZzZXQ9IjAuMTEiIHN0b3AtY29sb3I9IiNGRkY0NEYiLz4NCjxzdG9wIG9mZnNldD0iMC40NiIgc3RvcC1jb2xvcj0iI0ZGOTgwRSIvPg0KPHN0b3Agb2Zmc2V0PSIwLjYyIiBzdG9wLWNvbG9yPSIjRkY1NjM0Ii8+DQo8c3RvcCBvZmZzZXQ9IjAuNzIiIHN0b3AtY29sb3I9IiNGRjM2NDciLz4NCjxzdG9wIG9mZnNldD0iMC45IiBzdG9wLWNvbG9yPSIjRTMxNTg3Ii8+DQo8L3JhZGlhbEdyYWRpZW50Pg0KPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDhfcmFkaWFsXzg3XzcxMTgiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTguNzUxNyAxLjMzMzc0KSByb3RhdGUoODQuMjQ0Nykgc2NhbGUoMzEuMTk5NiAyMC40NTQzKSI+DQo8c3RvcCBzdG9wLWNvbG9yPSIjRkZGNDRGIi8+DQo8c3RvcCBvZmZzZXQ9IjAuMDYiIHN0b3AtY29sb3I9IiNGRkU4NDciLz4NCjxzdG9wIG9mZnNldD0iMC4xNyIgc3RvcC1jb2xvcj0iI0ZGQzgzMCIvPg0KPHN0b3Agb2Zmc2V0PSIwLjMiIHN0b3AtY29sb3I9IiNGRjk4MEUiLz4NCjxzdG9wIG9mZnNldD0iMC4zNiIgc3RvcC1jb2xvcj0iI0ZGOEIxNiIvPg0KPHN0b3Agb2Zmc2V0PSIwLjQ1IiBzdG9wLWNvbG9yPSIjRkY2NzJBIi8+DQo8c3RvcCBvZmZzZXQ9IjAuNTciIHN0b3AtY29sb3I9IiNGRjM2NDciLz4NCjxzdG9wIG9mZnNldD0iMC43NCIgc3RvcC1jb2xvcj0iI0UzMTU4NyIvPg0KPC9yYWRpYWxHcmFkaWVudD4NCjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQ5X3JhZGlhbF84N183MTE4IiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDE0Ljc3NTcgNi43MzU5Mykgc2NhbGUoMjYuNjY0NCAyNi43MjMpIj4NCjxzdG9wIG9mZnNldD0iMC4xNCIgc3RvcC1jb2xvcj0iI0ZGRjQ0RiIvPg0KPHN0b3Agb2Zmc2V0PSIwLjQ4IiBzdG9wLWNvbG9yPSIjRkY5ODBFIi8+DQo8c3RvcCBvZmZzZXQ9IjAuNTkiIHN0b3AtY29sb3I9IiNGRjU2MzQiLz4NCjxzdG9wIG9mZnNldD0iMC42NiIgc3RvcC1jb2xvcj0iI0ZGMzY0NyIvPg0KPHN0b3Agb2Zmc2V0PSIwLjkiIHN0b3AtY29sb3I9IiNFMzE1ODciLz4NCjwvcmFkaWFsR3JhZGllbnQ+DQo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50MTBfcmFkaWFsXzg3XzcxMTgiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjEuODE0NSA4LjMwMDU5KSBzY2FsZSgyOS4xODQ0IDI5LjI0ODQpIj4NCjxzdG9wIG9mZnNldD0iMC4wOSIgc3RvcC1jb2xvcj0iI0ZGRjQ0RiIvPg0KPHN0b3Agb2Zmc2V0PSIwLjIzIiBzdG9wLWNvbG9yPSIjRkZFMTQxIi8+DQo8c3RvcCBvZmZzZXQ9IjAuNTEiIHN0b3AtY29sb3I9IiNGRkFGMUUiLz4NCjxzdG9wIG9mZnNldD0iMC42MyIgc3RvcC1jb2xvcj0iI0ZGOTgwRSIvPg0KPC9yYWRpYWxHcmFkaWVudD4NCjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQxMV9saW5lYXJfODdfNzExOCIgeDE9IjI2Ljg1NSIgeTE9IjUuMzcyMTgiIHgyPSI3LjAxMDQzIiB5Mj0iMjUuMTczOSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KPHN0b3Agb2Zmc2V0PSIwLjE3IiBzdG9wLWNvbG9yPSIjRkZGNDRGIiBzdG9wLW9wYWNpdHk9IjAuOCIvPg0KPHN0b3Agb2Zmc2V0PSIwLjI3IiBzdG9wLWNvbG9yPSIjRkZGNDRGIiBzdG9wLW9wYWNpdHk9IjAuNjMiLz4NCjxzdG9wIG9mZnNldD0iMC40OSIgc3RvcC1jb2xvcj0iI0ZGRjQ0RiIgc3RvcC1vcGFjaXR5PSIwLjIyIi8+DQo8c3RvcCBvZmZzZXQ9IjAuNiIgc3RvcC1jb2xvcj0iI0ZGRjQ0RiIgc3RvcC1vcGFjaXR5PSIwIi8+DQo8L2xpbmVhckdyYWRpZW50Pg0KPC9kZWZzPg0KPC9zdmc+"
                alt="Firefox"
                className="w-7 h-7"
              />
            </div>
            <span className="font-medium text-gray-900 dark:text-white">Open in Firefox</span>
          </button>

          <button
            onClick={handleCopyLink}
            className="flex items-center gap-3 w-full p-4 rounded-xl bg-gray-100 dark:bg-neutral-800 hover:bg-gray-200 dark:hover:bg-neutral-700 transition-colors"
          >
            <div className="w-10 h-10 rounded-full bg-white dark:bg-neutral-700 flex items-center justify-center shadow-sm">
              {copied ? (
                <svg className="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                </svg>
              ) : (
                <svg className="w-6 h-6 text-gray-600 dark:text-neutral-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              )}
            </div>
            <span className="font-medium text-gray-900 dark:text-white">
              {copied ? 'Copied!' : 'Copy Link'}
            </span>
          </button>
        </div>

        {/* Open in Instagram option - less prominent */}
        <button
          onClick={handleOpenInInstagram}
          className="flex items-center justify-center gap-2 w-full mt-4 p-3 text-sm text-gray-500 dark:text-neutral-400 hover:text-gray-700 dark:hover:text-neutral-300 transition-colors"
        >
          <span>Continue in app</span>
          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </div>

      <style jsx>{`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
        }
        @keyframes slideUp {
          from { transform: translateY(100%); }
          to { transform: translateY(0); }
        }
        @keyframes slideDown {
          from { transform: translateY(0); }
          to { transform: translateY(100%); }
        }
      `}</style>
    </div>
  );
}

export function AnnouncementsGrid({ data, mode = 'grid', labels = {} }: AnnouncementsGridProps) {
  const hasChurchWide = data.ChurchWide && data.ChurchWide.length > 0;
  const hasCampus = data.Campus && data.Campus.Announcements && data.Campus.Announcements.length > 0;

  const scrollContainerRef = useRef<HTMLDivElement>(null);
  const progressBarRef = useRef<HTMLDivElement>(null);
  const progressBarContainerRef = useRef<HTMLDivElement>(null);
  const churchWideSectionRef = useRef<HTMLDivElement>(null);
  const campusSectionRef = useRef<HTMLDivElement>(null);
  const [hasOverflow, setHasOverflow] = useState(false);
  const [canScrollLeft, setCanScrollLeft] = useState(false);
  const [canScrollRight, setCanScrollRight] = useState(false);
  const [showChurchWideHeader, setShowChurchWideHeader] = useState(true);
  const [showCampusHeader, setShowCampusHeader] = useState(false);

  // Modal state for social mode link options
  const [linkOptionsUrl, setLinkOptionsUrl] = useState<string | null>(null);
  const [isEmbeddedMobile, setIsEmbeddedMobile] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);

  const isCarousel = mode === 'carousel';
  const isSocial = mode === 'social';

  // Detect system dark mode preference for social mode
  useEffect(() => {
    if (!isSocial) return;
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    setIsDarkMode(mediaQuery.matches);

    const handler = (e: MediaQueryListEvent) => setIsDarkMode(e.matches);
    mediaQuery.addEventListener('change', handler);
    return () => mediaQuery.removeEventListener('change', handler);
  }, [isSocial]);

  // Detect if we're in an embedded mobile context (e.g., Instagram in-app browser)
  // Check for in-app browsers via user agent OR iframe, AND small screen
  useEffect(() => {
    const checkEmbeddedMobile = () => {
      const userAgent = navigator.userAgent || '';
      // Detect common in-app browsers
      const isInAppBrowser = /Instagram|FBAN|FBAV|Twitter|TikTok|LinkedInApp/i.test(userAgent);
      const isInIframe = window.self !== window.top;
      const isSmallScreen = window.innerWidth < 768;
      // Show modal if (in-app browser OR iframe) AND small screen
      setIsEmbeddedMobile((isInAppBrowser || isInIframe) && isSmallScreen);
    };
    checkEmbeddedMobile();
    window.addEventListener('resize', checkEmbeddedMobile);
    return () => window.removeEventListener('resize', checkEmbeddedMobile);
  }, []);

  // Handle link click in social mode
  const handleSocialLinkClick = useCallback((e: React.MouseEvent, url: string) => {
    e.preventDefault();
    if (isEmbeddedMobile) {
      // In embedded mobile context (e.g., Instagram), show the options modal
      setLinkOptionsUrl(url);
    } else {
      // Otherwise, navigate directly
      window.open(url, '_blank');
    }
  }, [isEmbeddedMobile]);

  // Handle click on progress bar to scroll to position
  const handleProgressBarClick = (e: React.MouseEvent<HTMLDivElement>) => {
    if (!scrollContainerRef.current || !progressBarContainerRef.current) return;

    const rect = progressBarContainerRef.current.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const percentage = clickX / rect.width;

    const scrollContainer = scrollContainerRef.current;
    const maxScroll = scrollContainer.scrollWidth - scrollContainer.clientWidth;
    const targetScroll = maxScroll * percentage;

    scrollContainer.scrollTo({
      left: targetScroll,
      behavior: 'smooth'
    });
  };

  // Scroll left by viewport width
  const scrollLeft = () => {
    if (!scrollContainerRef.current) return;
    const scrollAmount = scrollContainerRef.current.clientWidth * 0.8;
    scrollContainerRef.current.scrollBy({
      left: -scrollAmount,
      behavior: 'smooth'
    });
  };

  // Scroll right by viewport width
  const scrollRight = () => {
    if (!scrollContainerRef.current) return;
    const scrollAmount = scrollContainerRef.current.clientWidth * 0.8;
    scrollContainerRef.current.scrollBy({
      left: scrollAmount,
      behavior: 'smooth'
    });
  };

  // Track scroll progress for carousel mode
  useEffect(() => {
    if (!isCarousel || !scrollContainerRef.current) return;

    const scrollContainer = scrollContainerRef.current;

    const checkOverflow = () => {
      const hasScroll = scrollContainer.scrollWidth > scrollContainer.clientWidth;
      setHasOverflow(hasScroll);
    };

    const updateProgress = () => {
      checkOverflow();

      const scrollLeft = scrollContainer.scrollLeft;
      const scrollWidth = scrollContainer.scrollWidth - scrollContainer.clientWidth;
      const scrollPercentage = scrollWidth > 0 ? scrollLeft / scrollWidth : 0;

      // Update progress bar
      if (progressBarRef.current) {
        // Show a minimum of 5% progress to indicate the progress bar exists
        const displayPercentage = Math.max(0.05, scrollPercentage);
        progressBarRef.current.style.transform = `scaleX(${displayPercentage})`;
      }

      // Update arrow visibility
      setCanScrollLeft(scrollLeft > 10); // Show left arrow if scrolled more than 10px
      setCanScrollRight(scrollLeft < scrollWidth - 10); // Show right arrow if not at end

      // Update sticky header visibility based on section visibility
      if (churchWideSectionRef.current && campusSectionRef.current) {
        const churchWideRect = churchWideSectionRef.current.getBoundingClientRect();
        const campusRect = campusSectionRef.current.getBoundingClientRect();
        const containerRect = scrollContainer.getBoundingClientRect();

        const churchWideVisible = churchWideRect.left < containerRect.right && churchWideRect.right > containerRect.left;
        const campusVisible = campusRect.left < containerRect.right && campusRect.right > containerRect.left;

        // Only show one header at a time - prioritize campus when both are visible
        // On desktop, show campus header when campus section is at least 40% in view
        const campusInViewAmount = Math.min(containerRect.right, campusRect.right) - Math.max(containerRect.left, campusRect.left);
        const campusInViewPercent = campusInViewAmount / containerRect.width;

        if (campusVisible && campusInViewPercent > 0.4) {
          setShowChurchWideHeader(false);
          setShowCampusHeader(true);
        } else if (churchWideVisible) {
          setShowChurchWideHeader(true);
          setShowCampusHeader(false);
        } else {
          setShowChurchWideHeader(churchWideVisible);
          setShowCampusHeader(campusVisible);
        }
      } else if (churchWideSectionRef.current) {
        setShowChurchWideHeader(true);
        setShowCampusHeader(false);
      }
    };

    scrollContainer.addEventListener('scroll', updateProgress);
    window.addEventListener('resize', checkOverflow);
    updateProgress(); // Initial update

    return () => {
      scrollContainer.removeEventListener('scroll', updateProgress);
      window.removeEventListener('resize', checkOverflow);
    };
  }, [isCarousel]);

  if (!hasChurchWide && !hasCampus) {
    return (
      <div className="my-6 md:my-10 p-6 bg-gray-50 text-primary/65 text-center rounded">
        No announcements to show.
      </div>
    );
  }

  // Social mode - compact horizontal list layout for Linktree replacement
  if (isSocial) {
    // Combine all announcements for social mode
    const allAnnouncements = [
      ...data.ChurchWide,
      ...(data.Campus?.Announcements || [])
    ];

    return (
      <div className={`max-w-lg md:max-w-2xl mx-auto relative bg-white dark:bg-neutral-900 ${isDarkMode ? 'dark' : ''}`}>
        {/* Woodside watermark - visible on all screen sizes for social mode */}
        <div
          className="absolute top-0 right-0 w-24 h-24 md:w-36 md:h-36 opacity-[0.04] pointer-events-none"
        >
          <svg
            viewBox="0 0 822.73 822.41"
            className="w-full h-full text-primary dark:text-white"
          >
            <path d="M482.59,292.96c-28.5,75.56-63.52,148.62-91.88,224.24-22.85,60.93-44.5,165.54,5.99,218.03,53.19,55.31,103.27-36.03,126.36-76.12,29.77-51.67,60.19-102.91,92.51-153.1,37.77-58.65,82.78-117.18,128.05-170.34,17.33-20.35,35.58-39.9,55.18-58.05,1.32-.3,1.67.72,2.19,1.61,2.7,4.68,6.16,19.72,7.79,25.79,55.59,207.53-59.67,424.44-261.39,494.49-162.86,56.55-343.5,6.03-452.97-125.71l.02-2.82c22.1-29.38,43.34-59.51,66.31-88.22,46.87-58.59,104.84-117,159.18-168.95,39.21-37.49,94.79-86.04,141.88-112.38,2.97-1.66,18.74-10.3,20.79-8.46Z" fill="currentColor"/>
            <path d="M454.78,615.29c-.4-37.26,12.31-73.93,23.96-108.91,21.35-64.11,58.46-144.93,65.26-211.05,10.09-98.15-75.84-54.82-121.59-23.71-87.22,59.32-157.97,140.42-238.72,207.44-1.08.9-1.56,2.33-3.36,1.91,29.91-61.5,79.75-118.22,92.63-187.03,26.62-142.2-143-109.97-223.13-77.75-1.54-1.51,19.5-33.71,21.85-37.14C170.36,35.21,348.48-31.19,518.31,14.05c111.97,29.83,206.98,107.78,259.7,210.54l-1.23,3.19c-101.38,85.68-182.57,188.93-258.5,297.03-21.17,30.14-40.81,61.47-63.5,90.48Z" fill="currentColor"/>
            <path d="M38.3,581.71c-6.2-9.05-10.4-20.99-14.14-31.42C-1.72,478.2-6.79,400.44,8.86,325.38c1.73-8.3,5.99-29.98,9.5-36.56,1.25-2.35,11.96-9.93,14.86-12.01,41.76-29.96,121.9-63.33,173.22-50.74,49.51,12.15,15.29,70.69-.39,97.86-34.22,59.31-78.86,114.75-116.32,172.48-18.06,27.83-35.65,56.1-51.43,85.3Z" fill="currentColor"/>
          </svg>
        </div>

        {/* Header */}
        <div className="text-center mb-6 md:mb-10">
          <div className="text-xs md:text-sm font-medium text-gray-400 dark:text-neutral-500 uppercase tracking-widest mb-1">
            {labels.carouselHeading1 || 'Stay in the know'}
          </div>
          <h1 className="text-3xl md:text-5xl font-bold tracking-tight text-gray-900 dark:text-white">
            {labels.carouselHeading2 || 'Announcements'}
          </h1>
          {/* Campus name if passed */}
          {hasCampus && data.Campus?.Name && (
            <div className="mt-4 md:mt-6">
              <div className="w-16 md:w-20 h-px bg-gray-300 dark:bg-neutral-700 mx-auto my-3 md:my-4" />
              <div className="text-xs md:text-sm font-medium text-gray-400 dark:text-neutral-500 uppercase tracking-widest">
                {data.Campus.Name} Campus
              </div>
            </div>
          )}
        </div>

        {/* Quick Links */}
        <QuickLinks openInNewTab onLinkClick={handleSocialLinkClick} />

        {/* Compact announcement list */}
        <div className="flex flex-col gap-4 mt-6 md:mt-10">
          {allAnnouncements.map((announcement) => {
            const heading = announcement.CallToAction?.Heading || announcement.Title;
            const subHeading = announcement.CallToAction?.SubHeading || announcement.Body;
            const hasLink = announcement.CallToAction?.Link;

            return (
              <React.Fragment key={announcement.ID}>
                <a
                  href={hasLink || '#'}
                  target="_blank"
                  rel="noopener noreferrer"
                  onClick={(e) => hasLink && handleSocialLinkClick(e, hasLink)}
                  className="flex items-center gap-3 md:gap-4 p-2 md:p-3 bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors duration-200 group"
                >
                  {/* Small thumbnail - 16:9 aspect ratio */}
                  <div className="flex-shrink-0 w-24 md:w-36 aspect-video overflow-hidden">
                    {announcement.Image ? (
                      <img
                        src={announcement.Image}
                        alt={announcement.Title}
                        loading="lazy"
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <div
                        className="w-full h-full grid place-items-center p-1 md:p-2"
                        style={{
                          backgroundColor: '#1c2b39',
                          backgroundImage: "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Ccircle cx='2' cy='2' r='1' fill='%23ffffff' fill-opacity='0.15'/%3E%3Ccircle cx='12' cy='12' r='1' fill='%23ffffff' fill-opacity='0.25'/%3E%3C/svg%3E\")",
                          backgroundRepeat: 'repeat',
                          backgroundSize: '10px 10px',
                        }}
                      >
                        <span className="text-white font-bold uppercase leading-tight text-center text-[8px] md:text-xs">
                          {announcement.Title.substring(0, 20)}
                        </span>
                      </div>
                    )}
                  </div>
                  {/* Text content */}
                  <div className="flex-1 min-w-0">
                    <h3 className="font-bold text-xs md:text-base leading-tight text-primary dark:text-white group-hover:text-secondary transition-colors duration-200">
                      {heading}
                    </h3>
                    {subHeading && (
                      <p className="text-[11px] md:text-sm text-gray-500 dark:text-neutral-400 mt-0.5 leading-snug">
                        {subHeading.replace(/<[^>]*>/g, '').trim().substring(0, 80)}
                      </p>
                    )}
                  </div>
                  {/* Arrow */}
                  <svg
                    className="w-5 h-5 md:w-6 md:h-6 flex-shrink-0 text-gray-400 dark:text-neutral-500 group-hover:text-secondary group-hover:translate-x-0.5 transition-all duration-200"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                  </svg>
                </a>
              </React.Fragment>
            );
          })}
        </div>

        {/* Link options modal (mobile only) */}
        {linkOptionsUrl && (
          <LinkOptionsModal
            url={linkOptionsUrl}
            onClose={() => setLinkOptionsUrl(null)}
          />
        )}
      </div>
    );
  }

  return (
    <div>
      {/* Main heading - shows for both carousel and grid modes */}
      <div className={isCarousel ? 'pb-4 md:pb-8 mb-2 md:mb-4 px-2 md:px-0' : 'pb-6 md:pb-0 mb-4 md:mb-8 px-2 md:px-0 relative overflow-visible animate-[fadeInFromRight_1.25s_ease-out_0s_both]'}>
        {/* Background Woodside logo is now rendered by the loading state transition - no static logo needed */}
        {/* Header with heading and navigation arrows */}
        <div className="flex justify-between items-center gap-3 md:mb-0 relative z-10">
          <div className={isCarousel ? 'flex-1 min-w-0' : 'flex-1 min-w-0 text-right'}>
            <div className={isCarousel ? 'text-xs md:text-sm font-medium text-gray-400 uppercase tracking-wide mb-0.5 md:mb-1' : 'text-sm md:text-base font-normal text-gray-400 uppercase tracking-widest'}>
              {labels.carouselHeading1 || 'Stay in the know'}
            </div>
            <h1 className={isCarousel ? 'text-xl md:text-4xl font-bold truncate' : 'text-3xl md:text-7xl lg:text-8xl font-bold tracking-tighter'}>
              {labels.carouselHeading2 || 'Announcements'}
            </h1>
            {/* Quick links - grid mode only */}
            {!isCarousel && <QuickLinks />}
          </div>
          {/* Navigation arrows visible on desktop only - carousel mode only */}
          {isCarousel && hasOverflow && (
            <div className="hidden md:flex items-center gap-2 flex-shrink-0">
              <button
                onClick={scrollLeft}
                disabled={!canScrollLeft}
                className={`w-10 h-10 flex items-center justify-center rounded-full border border-black/10 transition-all duration-200 ${
                  canScrollLeft
                    ? 'bg-white/90 hover:bg-white hover:scale-110'
                    : 'bg-gray-100 opacity-40 cursor-not-allowed'
                }`}
                aria-label="Scroll left"
              >
                <svg className="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
              </button>
              <button
                onClick={scrollRight}
                disabled={!canScrollRight}
                className={`w-10 h-10 flex items-center justify-center rounded-full border border-black/10 transition-all duration-200 ${
                  canScrollRight
                    ? 'bg-white/90 hover:bg-white hover:scale-110'
                    : 'bg-gray-100 opacity-40 cursor-not-allowed'
                }`}
                aria-label="Scroll right"
              >
                <svg className="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
              </button>
            </div>
          )}
        </div>
      </div>

      {/* Sticky section headers for carousel - mobile only */}
      {isCarousel && showChurchWideHeader && (
        <h2 className="md:hidden sticky top-0 left-0 right-0 bg-white dark:bg-neutral-900 z-20 py-3 pr-4 text-xs font-medium text-primary/60 dark:text-white/60 uppercase tracking-wide transition-opacity duration-200">
          {labels.churchWideTitle || 'Happening At Woodside'}
        </h2>
      )}
      {isCarousel && showCampusHeader && (
        <h2 className="md:hidden sticky top-0 left-0 right-0 bg-white dark:bg-neutral-900 z-20 py-3 pr-4 text-xs font-medium text-primary/60 dark:text-white/60 uppercase tracking-wide transition-opacity duration-200">
          {data.Campus!.Name || 'Campus'}
        </h2>
      )}

      <div ref={scrollContainerRef} className={isCarousel ? 'overflow-x-auto scrollbar-hide snap-x snap-mandatory' : ''}>
        <div className={isCarousel ? 'inline-flex' : 'block'}>
          {/* Church-wide Featured Announcements */}
          {hasChurchWide && (
            <div ref={churchWideSectionRef}>
              {!isCarousel && (
                <h2 className="mb-4 md:mb-6 text-lg md:text-3xl lg:text-4xl font-bold text-primary dark:text-white uppercase tracking-tight animate-[fadeInFromLeft_1.25s_ease-out_0.8s_both]">
                  {labels.churchWideTitle || 'Happening At Woodside'}
                </h2>
              )}
              {isCarousel && (
                <h2 className="hidden md:block mb-4 text-sm font-semibold text-primary/80 dark:text-white/80 uppercase tracking-wide">
                  {labels.churchWideTitle || 'Happening At Woodside'}
                </h2>
              )}
              <div
                className={
                  isCarousel
                    ? 'grid gap-6 pb-2 md:pb-8'
                    : (() => {
                        const count = data.ChurchWide.length;
                        // For 1-2 announcements, use flexbox like campus section for consistent sizing
                        if (count <= 2) return 'flex flex-wrap gap-3 md:gap-4';
                        if (count === 3) return 'grid gap-3 md:gap-4 grid-cols-1 md:grid-cols-6 md:grid-rows-2';
                        if (count === 4) return 'grid gap-3 md:gap-4 grid-cols-1 md:grid-cols-2';
                        if (count === 5) return 'grid gap-3 md:gap-4 grid-cols-1 md:grid-cols-6';
                        // 6+ announcements: masonry-style grid
                        return 'grid gap-3 md:gap-4 grid-cols-1 md:grid-cols-3';
                      })()
                }
                style={
                  isCarousel
                    ? {
                        gridTemplateAreas:
                          data.ChurchWide.length === 1 ? '"i1" "d1"' :
                          data.ChurchWide.length === 2 ? '"i1 i2" "d1 d2"' :
                          '"i1 i2 i3" "d1 d2 d3"',
                        gridTemplateColumns: `repeat(${Math.min(data.ChurchWide.length, 3)}, clamp(260px, 70vw, 400px))`,
                        gridTemplateRows: 'auto auto',
                        rowGap: '0.75rem',
                      }
                    : {}
                }
              >
                {(isCarousel ? data.ChurchWide.slice(0, 3) : data.ChurchWide).map((announcement, index) => {
                  const heading = announcement.CallToAction?.Heading || announcement.Title;
                  const subHeading = announcement.CallToAction?.SubHeading || announcement.Body;
                  const hasLink = announcement.CallToAction?.Link;

                  if (isCarousel) {
                    return (
                      <div key={announcement.ID} className="contents snap-start">
                        {/* Image */}
                        <a
                          href={hasLink || '#'}
                          className="relative block aspect-video overflow-hidden carousel-snap-item snap-start"
                          aria-label={announcement.Title}
                          style={{
                            gridArea: index === 0 ? 'i1' : index === 1 ? 'i2' : 'i3',
                          }}
                        >
                          {announcement.Image ? (
                            <img
                              src={announcement.Image}
                              alt={announcement.Title}
                              loading="lazy"
                              className="w-full h-full object-cover transition-transform duration-[650ms] ease-out hover:scale-[1.025]"
                            />
                          ) : (
                            <div
                              className="w-full h-full grid place-items-center p-4 md:p-7 outline outline-1 outline-white/95"
                              style={{
                                backgroundColor: '#1c2b39',
                                backgroundImage: "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Ccircle cx='2' cy='2' r='1' fill='%23ffffff' fill-opacity='0.15'/%3E%3Ccircle cx='12' cy='12' r='1' fill='%23ffffff' fill-opacity='0.25'/%3E%3C/svg%3E\")",
                                backgroundRepeat: 'repeat',
                                backgroundSize: '20px 20px',
                                outlineOffset: '-10px'
                              } as React.CSSProperties}
                            >
                              <span className="text-white font-extrabold uppercase leading-tight text-center text-xl md:text-3xl tracking-tight">
                                {announcement.Title}
                              </span>
                            </div>
                          )}
                        </a>
                        {/* Text body */}
                        <a
                          href={hasLink || '#'}
                          className="p-2 flex flex-col overflow-hidden hover:underline"
                          style={{
                            gridArea: index === 0 ? 'd1' : index === 1 ? 'd2' : 'd3',
                            width: 'clamp(260px, 70vw, 400px)',
                          }}
                        >
                          <h3 className="font-extrabold leading-tight mb-0.5 line-clamp-1 text-[clamp(0.8rem,1vw,1rem)] text-primary dark:text-white">
                            {heading}
                          </h3>
                          {subHeading && (
                            <p className="text-primary/65 dark:text-white/70 leading-snug line-clamp-2 text-[clamp(0.75rem,0.9vw,0.8rem)] m-0 p-0">
                              {subHeading.replace(/<[^>]*>/g, '').trim().substring(0, 140)}
                            </p>
                          )}
                        </a>
                      </div>
                    );
                  }

                  // Dynamic bento-box style grid with varied card sizes
                  const count = data.ChurchWide.length;
                  let cardClass = '';

                  if (!isCarousel) {
                    if (count <= 2) {
                      // Flexbox layout matching campus section for consistent sizing
                      cardClass = 'flex-1 min-w-[280px] max-w-[480px] md:min-w-[320px] md:max-w-[420px]';
                    } else if (count === 3) {
                      // 6-column, 2-row grid: [4x2] + [2x1] + [2x1]
                      // First card is wider (4 cols) = taller at 16:9, spans 2 rows
                      // Other cards are narrower (2 cols) = shorter at 16:9, 1 row each
                      // Math: 4*(9/16) = 2.25, and 2*(2*(9/16)) = 2*1.125 = 2.25 
                      if (index === 0) cardClass = 'md:col-span-4 md:row-span-2';
                      else cardClass = 'md:col-span-2';
                    } else if (count === 4) {
                      // 2-column, 2-row grid: all equal size
                      cardClass = '';
                    } else if (count === 5) {
                      // 6-column grid: 2 + 2 + 2 + 3 + 3
                      if (index < 3) cardClass = 'md:col-span-2';
                      else cardClass = 'md:col-span-3';
                    }
                  }

                  return (
                    <div
                      key={announcement.ID}
                      className={cardClass}
                      style={{
                        animation: `cardSlideIn 0.8s ease-out ${1.0 + (index * 0.6)}s both`
                      }}
                    >
                      <AnnouncementCard
                        announcement={announcement}
                      />
                    </div>
                  );
                })}
                {/* Invisible filler elements for 1-2 announcements to prevent stretching */}
                {!isCarousel && data.ChurchWide.length <= 2 && Array.from({ length: 5 }).map((_, i) => (
                  <div
                    key={`churchwide-filler-${i}`}
                    className="flex-1 min-w-[280px] max-w-[480px] md:min-w-[320px] md:max-w-[420px] h-0"
                    aria-hidden="true"
                  />
                ))}
              </div>
            </div>
          )}

          {/* Campus Announcements */}
          {hasCampus && (
            <div ref={campusSectionRef} className={isCarousel ? 'ml-6' : 'mt-6 md:mt-8'}>
              {!isCarousel && (() => {
                // Calculate when campus section should start animating
                // Church-wide cards start at 1.0s with 0.6s stagger and 0.8s duration
                const churchWideCount = hasChurchWide ? data.ChurchWide.length : 0;
                const lastChurchWideCardStart = 1.0 + ((churchWideCount - 1) * 0.6);
                const lastChurchWideCardEnd = lastChurchWideCardStart + 0.8;
                const campusHeaderDelay = hasChurchWide ? lastChurchWideCardEnd : 0.8;

                return (
                  <h2
                    className="mb-4 md:mb-6 text-lg md:text-3xl lg:text-4xl font-bold text-primary dark:text-white uppercase tracking-tight"
                    style={{
                      animation: `fadeInFromLeft 1.25s ease-out ${campusHeaderDelay}s both`
                    }}
                  >
                    {data.Campus!.Name || 'Campus'}
                  </h2>
                );
              })()}
              {isCarousel && (
                <h2 className="hidden md:block mb-4 text-sm font-semibold text-primary/80 dark:text-white/80 uppercase tracking-wide">
                  {data.Campus!.Name || 'Campus'}
                </h2>
              )}
              <div
                className={
                  isCarousel
                    ? 'flex gap-6'
                    : 'flex flex-wrap gap-3 md:gap-4'
                }
              >
                {data.Campus!.Announcements.map((announcement, index) => {
                  if (isCarousel) {
                    const heading = announcement.CallToAction?.Heading || announcement.Title;
                    const subHeading = announcement.CallToAction?.SubHeading || announcement.Body;
                    const hasLink = announcement.CallToAction?.Link;

                    return (
                      <div key={announcement.ID} className="w-[clamp(260px,70vw,400px)] flex flex-col snap-start">
                        <a
                          href={hasLink || '#'}
                          className="relative block aspect-video overflow-hidden carousel-snap-item"
                          aria-label={announcement.Title}
                        >
                          {announcement.Image ? (
                            <img
                              src={announcement.Image}
                              alt={announcement.Title}
                              loading="lazy"
                              className="w-full h-full object-cover transition-transform duration-[650ms] ease-out hover:scale-[1.025]"
                            />
                          ) : (
                            <div
                              className="w-full h-full grid place-items-center p-4 md:p-7 outline outline-1 outline-white/95"
                              style={{
                                backgroundColor: '#1c2b39',
                                backgroundImage: "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Ccircle cx='2' cy='2' r='1' fill='%23ffffff' fill-opacity='0.15'/%3E%3Ccircle cx='12' cy='12' r='1' fill='%23ffffff' fill-opacity='0.25'/%3E%3C/svg%3E\")",
                                backgroundRepeat: 'repeat',
                                backgroundSize: '20px 20px',
                                outlineOffset: '-10px'
                              } as React.CSSProperties}
                            >
                              <span className="text-white font-extrabold uppercase leading-tight text-center text-xl md:text-3xl tracking-tight">
                                {announcement.Title}
                              </span>
                            </div>
                          )}
                        </a>
                        <a
                          href={hasLink || '#'}
                          className="p-2 mt-3 flex flex-col overflow-hidden hover:underline"
                          style={{ width: 'clamp(260px, 70vw, 400px)' }}
                        >
                          <h3 className="font-extrabold leading-tight mb-0.5 line-clamp-1 text-[clamp(0.8rem,1vw,1rem)] text-primary dark:text-white">
                            {heading}
                          </h3>
                          {subHeading && (
                            <p className="text-primary/65 dark:text-white/70 leading-snug line-clamp-2 text-[clamp(0.75rem,0.9vw,0.8rem)] m-0 p-0">
                              {subHeading.replace(/<[^>]*>/g, '').trim().substring(0, 140)}
                            </p>
                          )}
                        </a>
                      </div>
                    );
                  }

                  // Calculate when campus cards should start animating
                  // Start cards shortly after header begins (0.3s overlap for smoother flow)
                  const churchWideCount = hasChurchWide ? data.ChurchWide.length : 0;
                  const lastChurchWideCardStart = 1.0 + ((churchWideCount - 1) * 0.6);
                  const lastChurchWideCardEnd = lastChurchWideCardStart + 0.8;
                  const campusHeaderDelay = hasChurchWide ? lastChurchWideCardEnd : 0.8;
                  const campusCardsStart = campusHeaderDelay + 0.3;

                  // Flexbox with consistent sizing - cards maintain same width across all rows
                  return (
                    <div
                      key={announcement.ID}
                      className="flex-1 min-w-[280px] max-w-[480px] md:min-w-[320px] md:max-w-[420px]"
                      style={{
                        animation: `cardSlideInFromLeft 0.8s ease-out ${campusCardsStart + (index * 0.6)}s both`
                      }}
                    >
                      <AnnouncementCard
                        announcement={announcement}
                      />
                    </div>
                  );
                })}
                {/* Invisible filler elements to prevent last row from growing */}
                {!isCarousel && Array.from({ length: 5 }).map((_, i) => (
                  <div
                    key={`filler-${i}`}
                    className="flex-1 min-w-[280px] max-w-[480px] md:min-w-[320px] md:max-w-[420px] h-0"
                    aria-hidden="true"
                  />
                ))}
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Progress bar for carousel mode */}
      {isCarousel && hasOverflow && (
        <div>
          <div
            ref={progressBarContainerRef}
            onClick={handleProgressBarClick}
            className="cursor-pointer py-2"
            aria-label="Scroll to position"
            role="slider"
            aria-valuemin={0}
            aria-valuemax={100}
          >
            <div className="h-1 bg-black/8 rounded-full overflow-hidden">
              <div
                ref={progressBarRef}
                className="h-full w-full bg-secondary origin-left transition-transform duration-[60ms] linear pointer-events-none"
                style={{ transform: 'scaleX(0)' }}
              />
            </div>
          </div>

          {/* Desktop subtle link below progress bar */}
          <div className="hidden md:flex justify-end mt-3">
            <a
              href="https://woodsidebible.org/Announcements"
              className="flex items-center gap-1.5 text-base font-semibold text-primary/70 dark:text-white/70 hover:text-primary dark:hover:text-white transition-colors duration-200 group uppercase tracking-wide"
            >
              <span>{labels.viewAllButton || 'View All Announcements'}</span>
              <svg
                className="w-5 h-5 transition-transform duration-200 group-hover:translate-x-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
        </div>
      )}

      {/* Mobile button */}
      {isCarousel && (
        <a
          href="https://woodsidebible.org/Announcements"
          className="block md:hidden mt-6 px-[10px] py-[12px] border-[3px] border-solid font-bold text-xs leading-none uppercase text-center no-underline"
          style={{
            backgroundColor: '#62bb46',
            borderColor: '#62bb46',
            color: '#fff',
            transition: 'background .3s, color .3s, border-color .3s',
          }}
          onMouseEnter={(e) => {
            e.currentTarget.style.backgroundColor = 'transparent';
            e.currentTarget.style.color = '#62bb46';
          }}
          onMouseLeave={(e) => {
            e.currentTarget.style.backgroundColor = '#62bb46';
            e.currentTarget.style.color = '#fff';
          }}
        >
          {labels.viewAllButton || 'View All Announcements'}
        </a>
      )}
    </div>
  );
}
